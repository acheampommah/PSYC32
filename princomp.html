<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Principal components</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="princomp_files/libs/clipboard/clipboard.min.js"></script>
<script src="princomp_files/libs/quarto-html/quarto.js"></script>
<script src="princomp_files/libs/quarto-html/popper.min.js"></script>
<script src="princomp_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="princomp_files/libs/quarto-html/anchor.min.js"></script>
<link href="princomp_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="princomp_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="princomp_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="princomp_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="princomp_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="princomp.html"><i class="bi bi-file-slides"></i>RevealJS</a></li><li><a href="princomp.pdf"><i class="bi bi-file-pdf"></i>Beamer</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Principal components</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="principal-components" class="level2">
<h2 class="anchored" data-anchor-id="principal-components">Principal Components</h2>
<ul>
<li><p>Have measurements on (possibly large) number of variables on some individuals.</p></li>
<li><p>Question: can we describe data using fewer variables (because original variables correlated in some way)?</p></li>
<li><p>Look for direction (linear combination of original variables) in which values <em>most spread out</em>. This is <em>first principal component</em>.</p></li>
<li><p>Second principal component then direction uncorrelated with this in which values then most spread out. And so on.</p></li>
</ul>
</section>
<section id="principal-components-1" class="level2">
<h2 class="anchored" data-anchor-id="principal-components-1">Principal components</h2>
<ul>
<li><p>See whether small number of principal components captures most of variation in data.</p></li>
<li><p>Might try to interpret principal components.</p></li>
<li><p>If 2 components good, can make plot of data.</p></li>
<li><p>(Like discriminant analysis, but for individuals rather than groups.)</p></li>
<li><p>“What are important ways that these data vary?”</p></li>
</ul>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>You might not have installed the first of these. See over for instructions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggbiplot) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: plyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: scales</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ lubridate 1.9.2     ✔ tibble    3.2.1
✔ purrr     1.0.1     ✔ tidyr     1.3.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::arrange()    masks plyr::arrange()
✖ readr::col_factor() masks scales::col_factor()
✖ purrr::compact()    masks plyr::compact()
✖ dplyr::count()      masks plyr::count()
✖ dplyr::desc()       masks plyr::desc()
✖ purrr::discard()    masks scales::discard()
✖ dplyr::failwith()   masks plyr::failwith()
✖ dplyr::filter()     masks stats::filter()
✖ dplyr::id()         masks plyr::id()
✖ dplyr::lag()        masks stats::lag()
✖ dplyr::mutate()     masks plyr::mutate()
✖ dplyr::rename()     masks plyr::rename()
✖ dplyr::summarise()  masks plyr::summarise()
✖ dplyr::summarize()  masks plyr::summarize()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>ggbiplot</code> has a special installation: see over.</p>
</section>
<section id="installing-ggbiplot" class="level2">
<h2 class="anchored" data-anchor-id="installing-ggbiplot">Installing <code>ggbiplot</code></h2>
<ul>
<li><p><code>ggbiplot</code> not on CRAN, so usual <code>install.packages</code> will not work. This is same procedure you used for <code>smmr</code> in C32:</p></li>
<li><p>Install package <code>devtools</code> first (once):</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Then install <code>ggbiplot</code> (once):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">"vqv/ggbiplot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="small-example-2-test-scores-for-8-people" class="level2">
<h2 class="anchored" data-anchor-id="small-example-2-test-scores-for-8-people">Small example: 2 test scores for 8 people</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/test12.txt"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>test12 <span class="ot">&lt;-</span> <span class="fu">read_table2</span>(my_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `read_table2()` was deprecated in readr 2.0.0.
ℹ Please use `read_table()` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>test12</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  first second id   
  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;
1     2      9 A    
2    16     40 B    
3     8     17 C    
4    18     43 D    
5    10     25 E    
6     4     10 F    
7    10     27 G    
8    12     30 H    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(test12, <span class="fu">aes</span>(<span class="at">x =</span> first, <span class="at">y =</span> second, <span class="at">label =</span> id)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_text_repel</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-plot" class="level2">
<h2 class="anchored" data-anchor-id="the-plot">The plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/ff2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="principal-component-analysis" class="level2">
<h2 class="anchored" data-anchor-id="principal-component-analysis">Principal component analysis</h2>
<ul>
<li>Grab just the numeric columns:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>test12 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="ot">-&gt;</span> test12_numbers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Strongly correlated, so data nearly 1-dimensional:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(test12_numbers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          first   second
first  1.000000 0.989078
second 0.989078 1.000000</code></pre>
</div>
</div>
</section>
<section id="finding-principal-components" class="level2">
<h2 class="anchored" data-anchor-id="finding-principal-components">Finding principal components</h2>
<ul>
<li>Make a score summarizing this one dimension. Like this:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>test12.pc <span class="ot">&lt;-</span> <span class="fu">princomp</span>(test12_numbers, <span class="at">cor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test12.pc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                         Comp.1      Comp.2
Standard deviation     1.410347 0.104508582
Proportion of Variance 0.994539 0.005461022
Cumulative Proportion  0.994539 1.000000000</code></pre>
</div>
</div>
</section>
<section id="comments" class="level2">
<h2 class="anchored" data-anchor-id="comments">Comments</h2>
<ul>
<li><p>“Standard deviation” shows relative importance of components (as for LDs in discriminant analysis)</p></li>
<li><p>Here, first one explains almost all (99.4%) of variability.</p></li>
<li><p>That is, look only at first component and ignore second.</p></li>
<li><p><code>cor=TRUE</code> standardizes all variables first. Usually wanted, because variables measured on different scales. (Only omit if variables measured on same scale and expect similar variability.)</p></li>
</ul>
</section>
<section id="scree-plot" class="level2">
<h2 class="anchored" data-anchor-id="scree-plot">Scree plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscreeplot</span>(test12.pc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/bPrincomp-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Imagine scree plot continues at zero, so 2 components is a <em>big</em> elbow (take one component).</p>
</section>
<section id="component-loadings" class="level2">
<h2 class="anchored" data-anchor-id="component-loadings">Component loadings</h2>
<p>explain how each principal component depends on (standardized) original variables (test scores):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>test12.pc<span class="sc">$</span>loadings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Loadings:
       Comp.1 Comp.2
first   0.707  0.707
second  0.707 -0.707

               Comp.1 Comp.2
SS loadings       1.0    1.0
Proportion Var    0.5    0.5
Cumulative Var    0.5    1.0</code></pre>
</div>
</div>
<p>First component basically sum of (standardized) test scores. That is, person tends to score similarly on two tests, and a composite score would summarize performance.</p>
</section>
<section id="component-scores" class="level2">
<h2 class="anchored" data-anchor-id="component-scores">Component scores</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(test12, test12.pc<span class="sc">$</span>scores)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first second id       Comp.1       Comp.2
1     2      9  A -2.071819003 -0.146981782
2    16     40  B  1.719862811 -0.055762223
3     8     17  C -0.762289708  0.207589512
4    18     43  D  2.176267535  0.042533250
5    10     25  E -0.007460609  0.007460609
6     4     10  F -1.734784030  0.070683441
7    10     27  G  0.111909141 -0.111909141
8    12     30  H  0.568313864 -0.013613668</code></pre>
</div>
</div>
<ul>
<li><p>Person A is a low scorer, very negative <code>comp.1</code> score.</p></li>
<li><p>Person D is high scorer, high positive <code>comp.1</code> score.</p></li>
<li><p>Person E average scorer, near-zero <code>comp.1</code> score.</p></li>
<li><p><code>comp.2</code> says basically nothing.</p></li>
</ul>
</section>
<section id="plot-of-scores" class="level2">
<h2 class="anchored" data-anchor-id="plot-of-scores">Plot of scores</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> Comp<span class="fl">.1</span>, <span class="at">y =</span> Comp<span class="fl">.2</span>, <span class="at">label =</span> id)) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_text_repel</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/score-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comments-1" class="level2">
<h2 class="anchored" data-anchor-id="comments-1">Comments</h2>
<ul>
<li><p>Vertical scale exaggerates importance of <code>comp.2</code>.</p></li>
<li><p>Fix up to get axes on same scale:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> Comp<span class="fl">.1</span>, <span class="at">y =</span> Comp<span class="fl">.2</span>, <span class="at">label =</span> id)) <span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_text_repel</span>() <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="ot">-&gt;</span> g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Shows how exam scores really spread out along one dimension:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/eqsc2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="the-biplot" class="level2">
<h2 class="anchored" data-anchor-id="the-biplot">The biplot</h2>
<ul>
<li><p>Plotting variables and individuals on one plot.</p></li>
<li><p>Shows how components and original variables related.</p></li>
<li><p>Shows how individuals score on each component, and therefore suggests how they score on each variable.</p></li>
<li><p>Add <code>labels</code> option to identify individuals:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggbiplot</span>(test12.pc, <span class="at">labels =</span> test12<span class="sc">$</span>id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-biplot-1" class="level2">
<h2 class="anchored" data-anchor-id="the-biplot-1">The biplot</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/ff3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comments-2" class="level2">
<h2 class="anchored" data-anchor-id="comments-2">Comments</h2>
<ul>
<li><p>Variables point almost same direction (right). Thus very positive value on <code>comp.1</code> goes with high scores on both tests, and test scores highly correlated.</p></li>
<li><p>Position of individuals on plot according to scores on principal components, implies values on original variables. Eg.:</p></li>
<li><p>D very positive on <code>comp.1</code>, high scorer on both tests.</p></li>
<li><p>A and F very negative on <code>comp.1</code>, poor scorers on both tests.</p></li>
<li><p>C positive on <code>comp.2</code>, high score on first test relative to second.</p></li>
<li><p>A negative on <code>comp.2</code>, high score on second test relative to first.</p></li>
</ul>
</section>
<section id="places-rated" class="level2">
<h2 class="anchored" data-anchor-id="places-rated">Places rated</h2>
<p>Every year, a new edition of the Places Rated Almanac is produced. This rates a large number (in our data 329) of American cities on a number of different criteria, to help people find the ideal place for them to live (based on what are important criteria for them).</p>
<p>The data for one year are in <a href="http://ritsokiguess.site/datafiles/places.txt">http://ritsokiguess.site/datafiles/places.txt</a>. The data columns are aligned but the column headings are not.</p>
</section>
<section id="the-criteria" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="the-criteria">The criteria</h2>
<p>There are nine of them:</p>
<ul>
<li><code>climate</code>: a higher value means that the weather is better</li>
<li><code>housing</code>: a higher value means that there is more good housing or a greater choice of different types of housing</li>
<li><code>health</code>: higher means better healthcare facilities</li>
<li><code>crime</code>: higher means more crime (bad)</li>
<li><code>trans</code>: higher means better transportation (this being the US, probably more roads)</li>
<li><code>educate</code>: higher means better educational facilities, schools, colleges etc.</li>
<li><code>arts</code>: higher means better access to the arts (theatre, music etc)</li>
<li><code>recreate</code>: higher means better access to recreational facilities</li>
<li><code>econ</code>: higher means a better economy (more jobs, spending power etc)</li>
</ul>
<p>Each city also has a numbered <code>id</code>.</p>
</section>
<section id="read-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-the-data">Read in the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/places.txt"</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>places0 <span class="ot">&lt;-</span> <span class="fu">read_table2</span>(my_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  climate = col_double(),
  housing = col_double(),
  health = col_double(),
  crime = col_double(),
  trans = col_double(),
  educate = col_double(),
  arts = col_double(),
  recreate = col_double(),
  econ = col_double(),
  id = col_double()
)</code></pre>
</div>
</div>
</section>
<section id="look-at-distributions-of-everything" class="level2">
<h2 class="anchored" data-anchor-id="look-at-distributions-of-everything">Look at distributions of everything</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>places0 <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>id, <span class="at">names_to =</span> <span class="st">"criterion"</span>, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"rating"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rating)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>criterion, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="ot">-&gt;</span> g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-histograms" class="level2">
<h2 class="anchored" data-anchor-id="the-histograms">The histograms</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/bPrincomp-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="transformations" class="level2">
<h2 class="anchored" data-anchor-id="transformations">Transformations</h2>
<ul>
<li><p>Several of these variables have long right tails</p></li>
<li><p>Take logs of everything but id:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>places0 <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>id, \(x) <span class="fu">log</span>(x))) <span class="ot">-&gt;</span> places</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="just-the-numerical-columns" class="level2">
<h2 class="anchored" data-anchor-id="just-the-numerical-columns">Just the numerical columns</h2>
<ul>
<li>get rid of the id column</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>places <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>id) <span class="ot">-&gt;</span> places_numeric</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="principal-components-2" class="level2">
<h2 class="anchored" data-anchor-id="principal-components-2">Principal components</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>places<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">princomp</span>(places_numeric, <span class="at">cor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(places<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          Comp.1    Comp.2    Comp.3    Comp.4     Comp.5
Standard deviation     1.8159827 1.1016178 1.0514418 0.9525124 0.92770076
Proportion of Variance 0.3664214 0.1348402 0.1228367 0.1008089 0.09562541
Cumulative Proportion  0.3664214 0.5012617 0.6240983 0.7249072 0.82053259
                           Comp.6     Comp.7     Comp.8     Comp.9
Standard deviation     0.74979050 0.69557215 0.56397886 0.50112689
Proportion of Variance 0.06246509 0.05375785 0.03534135 0.02790313
Cumulative Proportion  0.88299767 0.93675552 0.97209687 1.00000000</code></pre>
</div>
</div>
</section>
<section id="scree-plot-1" class="level2">
<h2 class="anchored" data-anchor-id="scree-plot-1">scree plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscreeplot</span>(places<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/bPrincomp-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>big elbow at 2 (1 component); smaller elbow at 6 (5) and maybe 4 (3).</li>
</ul>
</section>
<section id="what-is-in-each-component" class="level2">
<h2 class="anchored" data-anchor-id="what-is-in-each-component">What is in each component?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>places<span class="fl">.1</span><span class="sc">$</span>loadings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Loadings:
         Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7
climate   0.158         0.800  0.377         0.217  0.151
housing   0.384  0.139         0.197 -0.580         0.275
health    0.410 -0.372         0.113        -0.535 -0.135
crime     0.259  0.474  0.128         0.692 -0.140 -0.110
trans     0.375 -0.141 -0.141 -0.430  0.191  0.324  0.679
educate   0.274 -0.452 -0.241  0.457  0.225  0.527 -0.262
arts      0.474 -0.104        -0.147        -0.321 -0.120
recreate  0.353  0.292        -0.404 -0.306  0.394 -0.553
econ      0.164  0.540 -0.507  0.476                0.147
         Comp.8 Comp.9
climate   0.341       
housing  -0.606       
health    0.150  0.594
crime    -0.420       
trans     0.119  0.136
educate  -0.211 -0.110
arts      0.260 -0.747
recreate  0.138  0.226
econ      0.415       

               Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6
SS loadings     1.000  1.000  1.000  1.000  1.000  1.000
Proportion Var  0.111  0.111  0.111  0.111  0.111  0.111
Cumulative Var  0.111  0.222  0.333  0.444  0.556  0.667
               Comp.7 Comp.8 Comp.9
SS loadings     1.000  1.000  1.000
Proportion Var  0.111  0.111  0.111
Cumulative Var  0.778  0.889  1.000</code></pre>
</div>
</div>
</section>
<section id="assessing-the-components" class="level2">
<h2 class="anchored" data-anchor-id="assessing-the-components">Assessing the components</h2>
<p>Look at component loadings and make a call about “large” (in absolute value) vs “small”. Large loadings are a part of the component and small ones are not. Thus, if we use 0.4 as cutoff:</p>
<ul>
<li>component #1 depends on health and arts</li>
<li>#2 depends on economy and crime, and negatively on education.</li>
<li>#3 depends on climate, and negatively on economy.</li>
<li>#4 depends on education and the economy, negatively on transportation and recreation opportunities.</li>
<li>#5 depends on crime and negatively on housing.</li>
</ul>
</section>
<section id="comments-3" class="level2">
<h2 class="anchored" data-anchor-id="comments-3">Comments</h2>
<ul>
<li><p>The use of 0.4 is arbitrary; you can use whatever you like. It can be difficult to decide whether a variable is “in” or “out”.</p></li>
<li><p>The large (far from zero) loadings indicate what distinguishes the cities as places to live, for example:</p>
<ul>
<li>places that are rated high for health also tend to be rated high for arts</li>
<li>places that have a good economy tend to have a bad climate (and vice versa)</li>
<li>places that have a lot of crime tend to have bad housing.</li>
</ul></li>
</ul>
</section>
<section id="making-a-plot-13" class="level2">
<h2 class="anchored" data-anchor-id="making-a-plot-13">Making a plot 1/3</h2>
<p>How can we make a visual showing the cities? We need a “score” for each city on each component, and we need to identify the cities (we have a numerical <code>id</code> in the original dataset):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">city_id =</span> places<span class="sc">$</span>id, places<span class="fl">.1</span><span class="sc">$</span>scores) <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="ot">-&gt;</span> places_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>as_tibble</code> is needed at the end because the scores are a <code>matrix</code>.</p>
</section>
<section id="making-a-plot-23" class="level2">
<h2 class="anchored" data-anchor-id="making-a-plot-23">Making a plot 2/3</h2>
<ul>
<li>Plot the first two scores against each other, labelling each point by the <code>id</code> of the city it belongs to:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(places_score, <span class="fu">aes</span>(<span class="at">x =</span> Comp<span class="fl">.1</span>, <span class="at">y =</span> Comp<span class="fl">.2</span>, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">label =</span> city_id)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>() <span class="ot">-&gt;</span> g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="making-a-plot-33" class="level2">
<h2 class="anchored" data-anchor-id="making-a-plot-33">Making a plot 3/3</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/bPrincomp-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comments-4" class="level2">
<h2 class="anchored" data-anchor-id="comments-4">Comments</h2>
<ul>
<li><p>Cities 213 and 270 are high on component 1, and city 116 is low. City 195 is high on component 2, and city 322 is low.</p></li>
<li><p>This suggests that cities 213 and 270 are high on health and arts, and city 116 is low. City 195 should be high on economy and crime and low on education, and city 322 should be the other way around.</p></li>
</ul>
</section>
<section id="checking-this-12" class="level2">
<h2 class="anchored" data-anchor-id="checking-this-12">Checking this 1/2</h2>
<ul>
<li>The obvious way of checking this is in two steps: first, work out what high or low means for each variable:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(places)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    climate         housing           health          crime      
 Min.   :4.654   Min.   : 8.548   Min.   :3.761   Min.   :5.730  
 1st Qu.:6.174   1st Qu.: 8.819   1st Qu.:6.368   1st Qu.:6.561  
 Median :6.295   Median : 8.972   Median :6.725   Median :6.853  
 Mean   :6.260   Mean   : 8.997   Mean   :6.805   Mean   :6.796  
 3rd Qu.:6.384   3rd Qu.: 9.107   3rd Qu.:7.276   3rd Qu.:7.053  
 Max.   :6.813   Max.   :10.071   Max.   :8.968   Max.   :7.823  
     trans          educate           arts           recreate    
 Min.   :7.043   Min.   :7.439   Min.   : 3.951   Min.   :5.704  
 1st Qu.:8.052   1st Qu.:7.871   1st Qu.: 6.657   1st Qu.:7.182  
 Median :8.314   Median :7.935   Median : 7.534   Median :7.421  
 Mean   :8.283   Mean   :7.936   Mean   : 7.383   Mean   :7.429  
 3rd Qu.:8.557   3rd Qu.:8.010   3rd Qu.: 8.254   3rd Qu.:7.685  
 Max.   :9.062   Max.   :8.238   Max.   :10.946   Max.   :8.476  
      econ             id     
 Min.   :8.021   Min.   :  1  
 1st Qu.:8.485   1st Qu.: 83  
 Median :8.591   Median :165  
 Mean   :8.598   Mean   :165  
 3rd Qu.:8.718   3rd Qu.:247  
 Max.   :9.208   Max.   :329  </code></pre>
</div>
</div>
</section>
<section id="checking-this-22" class="level2">
<h2 class="anchored" data-anchor-id="checking-this-22">Checking this 2/2</h2>
<ul>
<li><p>and then find the values on the variables of interest for our cities of interest, and see where they sit on here.</p></li>
<li><p>Cities 270, 213, and 116 were extreme on component 1, which depended mainly on health and arts:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>places <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, health, arts) <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">270</span>, <span class="dv">213</span>, <span class="dv">166</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
     id health  arts
  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1   166   6.14  5.01
2   213   8.97 10.9 
3   270   8.22  9.56</code></pre>
</div>
</div>
<p>City 166 is near or below Q1 on both variables. City 213 is the highest of all on both <code>health</code> and <code>arts</code>, while city 270 is well above Q3 on both.</p>
</section>
<section id="checking-component-2" class="level2">
<h2 class="anchored" data-anchor-id="checking-component-2">Checking component 2</h2>
<ul>
<li>Component 2 depended positively on economy and crime and negatively on education. City 195 was high and 322 was low:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>places <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, econ, crime, educate) <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">195</span>, <span class="dv">322</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
     id  econ crime educate
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1   195  9.21  7.06    7.79
2   322  8.10  6.14    7.97</code></pre>
</div>
</div>
<ul>
<li>City 195 is the highest on economy, just above Q3 on crime, and below Q1 on education. City 322 should be the other way around: nearly the lowest on economy, below Q1 on crime, and between the median and Q3 on education. This is as we’d expect.</li>
</ul>
</section>
<section id="a-better-way-percentile-ranks" class="level2">
<h2 class="anchored" data-anchor-id="a-better-way-percentile-ranks">A better way: percentile ranks</h2>
<ul>
<li><p>It is a lot of work to find the value of each city on each variable in the data summary.</p></li>
<li><p>A better way is to work out the percentile ranks of each city on each variable and then look at those:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>places <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>id, \(x) <span class="fu">percent_rank</span>(x))) <span class="ot">-&gt;</span> places_pr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="look-up-cities-and-variables-again" class="level2">
<h2 class="anchored" data-anchor-id="look-up-cities-and-variables-again">Look up cities and variables again</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>places_pr <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, health, arts) <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">270</span>, <span class="dv">213</span>, <span class="dv">166</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
     id health   arts
  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1   166  0.152 0.0488
2   213  1     1     
3   270  0.970 0.982 </code></pre>
</div>
</div>
<p>This shows that city 270 was also really high on these two variables: in the 97th percentile for <code>health</code> and the 98th for <code>arts</code>.</p>
</section>
<section id="component-2" class="level2">
<h2 class="anchored" data-anchor-id="component-2">Component 2</h2>
<ul>
<li>What about the extreme cities on component 2?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>places_pr <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, econ, crime, educate) <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">195</span>, <span class="dv">322</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
     id    econ  crime educate
  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1   195 1       0.762   0.0884
2   322 0.00610 0.0732  0.631 </code></pre>
</div>
</div>
<ul>
<li><p>City 322 was really low on economy and crime, but only just above average on education. City 195 was the highest on economy and really low on education, but only somewhat high on crime (76th percentile).</p></li>
<li><p>This, as you see, is much easier once you have set it up.</p></li>
</ul>
</section>
<section id="the-biplot-2" class="level2">
<h2 class="anchored" data-anchor-id="the-biplot-2">The biplot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbiplot</span>(places<span class="fl">.1</span>, <span class="at">labels =</span> places<span class="sc">$</span>id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/bPrincomp-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comments-5" class="level2">
<h2 class="anchored" data-anchor-id="comments-5">Comments</h2>
<ul>
<li>This is hard to read!</li>
<li>There are a lot of cities that overshadow the red arrows for the variables.</li>
<li>reduce the size of the city labels</li>
</ul>
</section>
<section id="biplot-attempt-2" class="level2">
<h2 class="anchored" data-anchor-id="biplot-attempt-2">Biplot, attempt 2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbiplot</span>(places<span class="fl">.1</span>, <span class="at">labels =</span> places<span class="sc">$</span>id,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels.size =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/bPrincomp-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comments-on-attempt-2" class="level2">
<h2 class="anchored" data-anchor-id="comments-on-attempt-2">Comments on attempt #2</h2>
<ul>
<li>Now at least can see the variables</li>
<li>All of them point somewhat right (all belong partly to component 1)</li>
<li>Some of them (economy, crime, education) point up/down, belong to component 2 as well.</li>
<li>In this case, cannot really see both observations (cities) and variables (criteria) together, which defeats the purpose of the biplot.</li>
<li>Have to try it and see.</li>
</ul>
</section>
<section id="principal-components-from-correlation-matrix" class="level2">
<h2 class="anchored" data-anchor-id="principal-components-from-correlation-matrix">Principal components from correlation matrix</h2>
<p>Create data file like this:</p>
<pre><code> 1        0.9705 -0.9600
 0.9705   1      -0.9980
-0.9600  -0.9980  1</code></pre>
<p>and read in like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/cov.txt"</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">read_table</span>(my_url, <span class="at">col_names =</span> F)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
      X1     X2     X3
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1  1      0.970 -0.96 
2  0.970  1     -0.998
3 -0.96  -0.998  1    </code></pre>
</div>
</div>
</section>
<section id="pre-processing" class="level2">
<h2 class="anchored" data-anchor-id="pre-processing">Pre-processing</h2>
<p>A little pre-processing required:</p>
<ul>
<li><p>Turn into matrix (from data frame)</p></li>
<li><p>Feed into <code>princomp</code> as <code>covmat=</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>mat.pc <span class="ot">&lt;-</span> mat <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">princomp</span>(<span class="at">covmat =</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scree-plot-one-component-fine" class="level2">
<h2 class="anchored" data-anchor-id="scree-plot-one-component-fine">Scree plot: one component fine</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscreeplot</span>(mat.pc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="princomp_files/figure-html/palermo-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="component-loadings-1" class="level2">
<h2 class="anchored" data-anchor-id="component-loadings-1">Component loadings</h2>
<p>Compare correlation matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
      X1     X2     X3
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1  1      0.970 -0.96 
2  0.970  1     -0.998
3 -0.96  -0.998  1    </code></pre>
</div>
</div>
<p>with component loadings</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>mat.pc<span class="sc">$</span>loadings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Loadings:
   Comp.1 Comp.2 Comp.3
X1  0.573  0.812  0.112
X2  0.581 -0.306 -0.755
X3 -0.578  0.498 -0.646

               Comp.1 Comp.2 Comp.3
SS loadings     1.000  1.000  1.000
Proportion Var  0.333  0.333  0.333
Cumulative Var  0.333  0.667  1.000</code></pre>
</div>
</div>
</section>
<section id="comments-6" class="level2">
<h2 class="anchored" data-anchor-id="comments-6">Comments</h2>
<ul>
<li><p>When X1 large, X2 also large, X3 small.</p>
<ul>
<li>Then <code>comp.1</code> <em>positive</em>.</li>
</ul></li>
<li><p>When X1 small, X2 small, X3 large.</p>
<ul>
<li>Then <code>comp.1</code> <em>negative</em>.</li>
</ul></li>
</ul>
</section>
<section id="no-scores" class="level2">
<h2 class="anchored" data-anchor-id="no-scores">No scores</h2>
<ul>
<li><p>With correlation matrix rather than data, no component scores</p>
<ul>
<li><p>So no principal component plot</p></li>
<li><p>and no biplot.</p></li>
</ul></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>