<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The sign test</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="inference_3_files/libs/clipboard/clipboard.min.js"></script>
<script src="inference_3_files/libs/quarto-html/quarto.js"></script>
<script src="inference_3_files/libs/quarto-html/popper.min.js"></script>
<script src="inference_3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="inference_3_files/libs/quarto-html/anchor.min.js"></script>
<link href="inference_3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="inference_3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="inference_3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="inference_3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="inference_3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="inference_3.html"><i class="bi bi-file-slides"></i>RevealJS</a></li><li><a href="inference_3.pdf"><i class="bi bi-file-pdf"></i>Beamer</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The sign test</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   0.5.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smmr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>smmr</code> is new. See later how to install it.</p>
</section>
<section id="duality-between-confidence-intervals-and-hypothesis-tests" class="level2">
<h2 class="anchored" data-anchor-id="duality-between-confidence-intervals-and-hypothesis-tests">Duality between confidence intervals and hypothesis tests</h2>
<ul>
<li>Tests and CIs really do the same thing, if you look at them the right way. They are both telling you something about a parameter, and they use same things about data.</li>
<li>To illustrate, some data (two groups):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/duality.txt"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>twogroups <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url,<span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 15 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
dbl (2): y, group

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>twogroups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 2
       y group
   &lt;dbl&gt; &lt;dbl&gt;
 1    10     1
 2    11     1
 3    11     1
 4    13     1
 5    13     1
 6    14     1
 7    14     1
 8    15     1
 9    16     1
10    13     2
11    13     2
12    14     2
13    17     2
14    18     2
15    19     2</code></pre>
</div>
</div>
</section>
<section id="ci-default" class="level2">
<h2 class="anchored" data-anchor-id="ci-default">95% CI (default)</h2>
<p>for difference in means, group 1 minus group 2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(y <span class="sc">~</span> group, <span class="at">data =</span> twogroups)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  y by group
t = -2.0937, df = 8.7104, p-value = 0.0668
alternative hypothesis: true difference in means between group 1 and group 2 is not equal to 0
95 percent confidence interval:
 -5.5625675  0.2292342
sample estimates:
mean in group 1 mean in group 2 
       13.00000        15.66667 </code></pre>
</div>
</div>
</section>
<section id="ci" class="level2">
<h2 class="anchored" data-anchor-id="ci">90% CI</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(y <span class="sc">~</span> group, <span class="at">data =</span> twogroups, <span class="at">conf.level =</span> <span class="fl">0.90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  y by group
t = -2.0937, df = 8.7104, p-value = 0.0668
alternative hypothesis: true difference in means between group 1 and group 2 is not equal to 0
90 percent confidence interval:
 -5.010308 -0.323025
sample estimates:
mean in group 1 mean in group 2 
       13.00000        15.66667 </code></pre>
</div>
</div>
</section>
<section id="hypothesis-test" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-test">Hypothesis test</h2>
<p>Null is that difference in means is zero:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(y <span class="sc">~</span> group, <span class="at">mu=</span><span class="dv">0</span>, <span class="at">data =</span> twogroups)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  y by group
t = -2.0937, df = 8.7104, p-value = 0.0668
alternative hypothesis: true difference in means between group 1 and group 2 is not equal to 0
95 percent confidence interval:
 -5.5625675  0.2292342
sample estimates:
mean in group 1 mean in group 2 
       13.00000        15.66667 </code></pre>
</div>
</div>
</section>
<section id="comparing-results" class="level2">
<h2 class="anchored" data-anchor-id="comparing-results">Comparing results</h2>
<p>Recall null here is <span class="math inline">\(H_0 : \mu_1 - \mu_2 = 0\)</span>. P-value 0.0668.</p>
<ul>
<li>95% CI from <span class="math inline">\(-5.6\)</span> to <span class="math inline">\(0.2\)</span>, contains <span class="math inline">\(0\)</span>.</li>
<li>90% CI from <span class="math inline">\(-5.0\)</span> to <span class="math inline">\(-0.3\)</span>, does not contain <span class="math inline">\(0\)</span>.</li>
<li>At <span class="math inline">\(\alpha = 0.05\)</span>, would not reject <span class="math inline">\(H_0\)</span> since P-value <span class="math inline">\(&gt; 0.05\)</span>.</li>
<li>At <span class="math inline">\(\alpha = 0.10\)</span>, <em>would</em> reject <span class="math inline">\(H_0\)</span> since P-value <span class="math inline">\(&lt; 0.10\)</span>.</li>
</ul>
</section>
<section id="test-and-ci" class="level2">
<h2 class="anchored" data-anchor-id="test-and-ci">Test and CI</h2>
<p>Not just coincidence. Let <span class="math inline">\(C = 100(1 - \alpha)\)</span>, so C% gives corresponding CI to level-<span class="math inline">\(\alpha\)</span> test. Then following always true. (Symbol <span class="math inline">\(\iff\)</span> means “if and only if”.)</p>
<table class="table">
<colgroup>
<col style="width: 41%">
<col style="width: 17%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Test decision</th>
<th style="text-align: center;"></th>
<th style="text-align: left;">Confidence interval</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Reject <span class="math inline">\(H_0\)</span> at level <span class="math inline">\(\alpha\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\iff\)</span></td>
<td style="text-align: left;"><span class="math inline">\(C\%\)</span> CI does not contain <span class="math inline">\(H_0\)</span> value</td>
</tr>
<tr class="even">
<td style="text-align: left;">Do not reject <span class="math inline">\(H_0\)</span> at level <span class="math inline">\(\alpha\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\iff\)</span></td>
<td style="text-align: left;"><span class="math inline">\(C\%\)</span> CI contains <span class="math inline">\(H_0\)</span> value</td>
</tr>
</tbody>
</table>
<p>Idea: “Plausible” parameter value inside CI, not rejected; “Implausible” parameter value outside CI, rejected.</p>
</section>
<section id="the-value-of-this" class="level2">
<h2 class="anchored" data-anchor-id="the-value-of-this">The value of this</h2>
<ul>
<li>If you have a test procedure but no corresponding CI:</li>
<li>you make a CI by including all the parameter values that would not be rejected by your test.</li>
<li>Use:
<ul>
<li><span class="math inline">\(\alpha = 0.01\)</span> for a 99% CI,</li>
<li><span class="math inline">\(\alpha = 0.05\)</span> for a 95% CI,</li>
<li><span class="math inline">\(\alpha = 0.10\)</span> for a 90% CI, and so on.</li>
</ul></li>
</ul>
</section>
<section id="testing-for-non-normal-data" class="level2">
<h2 class="anchored" data-anchor-id="testing-for-non-normal-data">Testing for non-normal data</h2>
<ul>
<li>The IRS (“Internal Revenue Service”) is the US authority that deals with taxes (like Revenue Canada).</li>
<li>One of their forms is supposed to take no more than 160 minutes to complete. A citizen’s organization claims that it takes people longer than that on average.</li>
<li>Sample of 30 people; time to complete form recorded.</li>
<li>Read in data, and do <span class="math inline">\(t\)</span>-test of <span class="math inline">\(H_0 : \mu = 160\)</span> vs.&nbsp;<span class="math inline">\(H_a : \mu &gt; 160\)</span>.</li>
<li>For reading in, there is only one column, so can pretend it is delimited by anything.</li>
</ul>
</section>
<section id="read-in-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-data">Read in data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/irs.txt"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>irs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(my_url)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>irs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 1
    Time
   &lt;dbl&gt;
 1    91
 2    64
 3   243
 4   167
 5   123
 6    65
 7    71
 8   204
 9   110
10   178
# ℹ 20 more rows</code></pre>
</div>
</div>
</section>
<section id="test-whether-mean-is-160-or-greater" class="level2">
<h2 class="anchored" data-anchor-id="test-whether-mean-is-160-or-greater">Test whether mean is 160 or greater</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(irs, <span class="fu">t.test</span>(Time, <span class="at">mu =</span> <span class="dv">160</span>, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alternative =</span> <span class="st">"greater"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  Time
t = 1.8244, df = 29, p-value = 0.03921
alternative hypothesis: true mean is greater than 160
95 percent confidence interval:
 162.8305      Inf
sample estimates:
mean of x 
 201.2333 </code></pre>
</div>
</div>
<p>Reject null; mean (for all people to complete form) greater than 160.</p>
</section>
<section id="but-look-at-a-graph" class="level2">
<h2 class="anchored" data-anchor-id="but-look-at-a-graph">But, look at a graph</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(irs, <span class="fu">aes</span>(<span class="at">x =</span> Time)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inference_3_files/figure-html/inference-3-R-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comments" class="level2">
<h2 class="anchored" data-anchor-id="comments">Comments</h2>
<ul>
<li>Skewed to right.</li>
<li>Should look at <em>median</em>, not mean.</li>
</ul>
</section>
<section id="the-sign-test" class="level2">
<h2 class="anchored" data-anchor-id="the-sign-test">The sign test</h2>
<ul>
<li>But how to test whether the median is greater than 160?</li>
<li>Idea: if the median really is 160 (<span class="math inline">\(H_0\)</span> true), the sampled values from the population are equally likely to be above or below 160.</li>
<li>If the population median is greater than 160, there will be a lot of sample values greater than 160, not so many less. Idea: test statistic is number of sample values greater than hypothesized median.</li>
</ul>
</section>
<section id="getting-a-p-value-for-sign-test-13" class="level2">
<h2 class="anchored" data-anchor-id="getting-a-p-value-for-sign-test-13">Getting a P-value for sign test 1/3</h2>
<ul>
<li>How to decide whether “unusually many” sample values are greater than 160? Need a sampling distribution.</li>
<li>If <span class="math inline">\(H_0\)</span> true, pop. median is 160, then each sample value independently equally likely to be above or below 160.</li>
<li>So number of observed values above 160 has binomial distribution with <span class="math inline">\(n = 30\)</span> (number of data values) and <span class="math inline">\(p = 0.5\)</span> (160 is hypothesized to be <em>median</em>).</li>
</ul>
</section>
<section id="getting-p-value-for-sign-test-23" class="level2">
<h2 class="anchored" data-anchor-id="getting-p-value-for-sign-test-23">Getting P-value for sign test 2/3</h2>
<ul>
<li>Count values above/below 160:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>irs <span class="sc">%&gt;%</span> <span class="fu">count</span>(Time <span class="sc">&gt;</span> <span class="dv">160</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  `Time &gt; 160`     n
  &lt;lgl&gt;        &lt;int&gt;
1 FALSE           13
2 TRUE            17</code></pre>
</div>
</div>
<ul>
<li>17 above, 13 below. How unusual is that? Need a <em>binomial table</em>.</li>
</ul>
</section>
<section id="getting-p-value-for-sign-test-33" class="level2">
<h2 class="anchored" data-anchor-id="getting-p-value-for-sign-test-33">Getting P-value for sign test 3/3</h2>
<ul>
<li>R function <code>dbinom</code> gives the probability of eg. exactly 17 successes in a binomial with <span class="math inline">\(n = 30\)</span> and <span class="math inline">\(p = 0.5\)</span>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="dv">17</span>, <span class="dv">30</span>, <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1115351</code></pre>
</div>
</div>
<ul>
<li>but we want probability of 17 <em>or more</em>, so get all of those, find probability of each, and add them up:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x=</span><span class="dv">17</span><span class="sc">:</span><span class="dv">30</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob=</span><span class="fu">dbinom</span>(x, <span class="dv">30</span>, <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total=</span><span class="fu">sum</span>(prob))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  total
  &lt;dbl&gt;
1 0.292</code></pre>
</div>
</div>
</section>
<section id="using-my-package-smmr" class="level2">
<h2 class="anchored" data-anchor-id="using-my-package-smmr">Using my package <code>smmr</code></h2>
<ul>
<li>I wrote a package <code>smmr</code> to do the sign test (and some other things). Installation is a bit fiddly:
<ul>
<li>Install devtools (once) with</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>then install <code>smmr</code> using <code>devtools</code> (once):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">"nxskok/smmr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Then load it:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smmr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="smmr-for-sign-test" class="level2">
<h2 class="anchored" data-anchor-id="smmr-for-sign-test"><code>smmr</code> for sign test</h2>
<ul>
<li><code>smmr</code>’s function <code>sign_test</code> needs three inputs: a data frame, a column and a null median:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sign_test</span>(irs, Time, <span class="dv">160</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$above_below
below above 
   13    17 

$p_values
  alternative   p_value
1       lower 0.8192027
2       upper 0.2923324
3   two-sided 0.5846647</code></pre>
</div>
</div>
</section>
<section id="comments-13" class="level2">
<h2 class="anchored" data-anchor-id="comments-13">Comments (1/3)</h2>
<ul>
<li>Testing whether population median <em>greater than</em> 160, so want <em>upper-tail</em> P-value 0.2923. Same as before.</li>
<li>Also get table of values above and below; this too as we got.</li>
</ul>
</section>
<section id="comments-23" class="level2">
<h2 class="anchored" data-anchor-id="comments-23">Comments (2/3)</h2>
<ul>
<li>P-values are:</li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Test</th>
<th style="text-align: right;">P-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(t\)</span></td>
<td style="text-align: right;">0.0392</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sign</td>
<td style="text-align: right;">0.2923</td>
</tr>
</tbody>
</table>
<ul>
<li>These are very different: we reject a mean of 160 (in favour of the mean being bigger), but clearly <em>fail</em> to reject a median of 160 in favour of a bigger one.</li>
<li>Why is that? Obtain mean and median:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>irs <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">mean_time =</span> <span class="fu">mean</span>(Time), </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">median_time =</span> <span class="fu">median</span>(Time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  mean_time median_time
      &lt;dbl&gt;       &lt;dbl&gt;
1      201.        172.</code></pre>
</div>
</div>
</section>
<section id="comments-33" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="comments-33">Comments (3/3)</h2>
<ul>
<li>The mean is pulled a long way up by the right skew, and is a fair bit bigger than 160.</li>
<li>The median is quite close to 160.</li>
<li>We ought to be trusting the sign test and not the t-test here (median and not mean), and therefore there is no evidence that the “typical” time to complete the form is longer than 160 minutes.</li>
<li>Having said that, there are clearly some people who take a lot longer than 160 minutes to complete the form, and the IRS could focus on simplifying its form for these people.</li>
<li>In this example, looking at any kind of average is not really helpful; a better question might be “do an unacceptably large fraction of people take longer than (say) 300 minutes to complete the form?”: that is, thinking about worst-case rather than average-case.</li>
</ul>
</section>
<section id="confidence-interval-for-the-median" class="level2">
<h2 class="anchored" data-anchor-id="confidence-interval-for-the-median">Confidence interval for the median</h2>
<ul>
<li>The sign test does not naturally come with a confidence interval for the median.</li>
<li>So we use the “duality” between test and confidence interval to say: the (95%) confidence interval for the median contains exactly those values of the null median that would not be rejected by the two-sided sign test (at <span class="math inline">\(\alpha = 0.05\)</span>).</li>
</ul>
</section>
<section id="for-our-data" class="level2">
<h2 class="anchored" data-anchor-id="for-our-data">For our data</h2>
<ul>
<li>The procedure is to try some values for the null median and see which ones are inside and which outside our CI.</li>
<li>smmr has pval_sign that gets just the 2-sided P-value:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pval_sign</span>(<span class="dv">160</span>, irs, Time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5846647</code></pre>
</div>
</div>
<ul>
<li>Try a couple of null medians:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pval_sign</span>(<span class="dv">200</span>, irs, Time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3615946</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pval_sign</span>(<span class="dv">300</span>, irs, Time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.001430906</code></pre>
</div>
</div>
<ul>
<li>So 200 inside the 95% CI and 300 outside.</li>
</ul>
</section>
<section id="doing-a-whole-bunch" class="level2">
<h2 class="anchored" data-anchor-id="doing-a-whole-bunch">Doing a whole bunch</h2>
<ul>
<li>Choose our null medians first:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>(d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">null_median=</span><span class="fu">seq</span>(<span class="dv">100</span>,<span class="dv">300</span>,<span class="dv">20</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 1
   null_median
         &lt;dbl&gt;
 1         100
 2         120
 3         140
 4         160
 5         180
 6         200
 7         220
 8         240
 9         260
10         280
11         300</code></pre>
</div>
</div>
</section>
<section id="and-then" class="level2">
<h2 class="anchored" data-anchor-id="and-then">… and then</h2>
<p>“for each null median, run the function <code>pval_sign</code> for that null median and get the P-value”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_value =</span> <span class="fu">pval_sign</span>(null_median, irs, Time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
# Rowwise: 
   null_median  p_value
         &lt;dbl&gt;    &lt;dbl&gt;
 1         100 0.000325
 2         120 0.0987  
 3         140 0.200   
 4         160 0.585   
 5         180 0.856   
 6         200 0.362   
 7         220 0.0428  
 8         240 0.0161  
 9         260 0.00522 
10         280 0.00143 
11         300 0.00143 </code></pre>
</div>
</div>
</section>
<section id="make-it-easier-for-ourselves" class="level2">
<h2 class="anchored" data-anchor-id="make-it-easier-for-ourselves">Make it easier for ourselves</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_value =</span> <span class="fu">pval_sign</span>(null_median, irs, Time)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_out =</span> <span class="fu">ifelse</span>(p_value <span class="sc">&gt;</span> <span class="fl">0.05</span>, <span class="st">"inside"</span>, <span class="st">"outside"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
# Rowwise: 
   null_median  p_value in_out 
         &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  
 1         100 0.000325 outside
 2         120 0.0987   inside 
 3         140 0.200    inside 
 4         160 0.585    inside 
 5         180 0.856    inside 
 6         200 0.362    inside 
 7         220 0.0428   outside
 8         240 0.0161   outside
 9         260 0.00522  outside
10         280 0.00143  outside
11         300 0.00143  outside</code></pre>
</div>
</div>
</section>
<section id="confidence-interval-for-median" class="level2">
<h2 class="anchored" data-anchor-id="confidence-interval-for-median">confidence interval for median?</h2>
<ul>
<li>95% CI to this accuracy from 120 to 200.</li>
<li>Can get it more accurately by looking more closely in intervals from 100 to 120, and from 200 to 220.</li>
</ul>
</section>
<section id="a-more-efficient-way-bisection" class="level2">
<h2 class="anchored" data-anchor-id="a-more-efficient-way-bisection">A more efficient way: bisection</h2>
<ul>
<li>Know that top end of CI between 200 and 220:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">&lt;-</span> <span class="dv">200</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>hi <span class="ot">&lt;-</span> <span class="dv">220</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Try the value halfway between: is it inside or outside?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>try <span class="ot">&lt;-</span> (lo <span class="sc">+</span> hi) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>try </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 210</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pval_sign</span>(try,irs,Time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09873715</code></pre>
</div>
</div>
<ul>
<li>Inside, so upper end is between 210 and 220. Repeat (over):</li>
</ul>
</section>
<section id="bisection-continued" class="level2">
<h2 class="anchored" data-anchor-id="bisection-continued">… bisection continued</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">=</span> try</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>(<span class="at">try =</span> (lo <span class="sc">+</span> hi) <span class="sc">/</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 215</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pval_sign</span>(try, irs, Time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06142835</code></pre>
</div>
</div>
<ul>
<li>215 is inside too, so upper end between 215 and 220.</li>
<li>Continue until have as accurate a result as you want.</li>
</ul>
</section>
<section id="bisection-automatically" class="level2">
<h2 class="anchored" data-anchor-id="bisection-automatically">Bisection automatically</h2>
<ul>
<li>A loop, but not a <code>for</code> since we don’t know how many times we’re going around. Keep going <code>while</code> a condition is true:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">=</span> <span class="dv">200</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>hi <span class="ot">=</span> <span class="dv">220</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (hi <span class="sc">-</span> lo <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  try <span class="ot">=</span> (hi <span class="sc">+</span> lo) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  ptry <span class="ot">=</span> <span class="fu">pval_sign</span>(try, irs, Time)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(try, ptry))</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ptry <span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    hi <span class="ot">=</span> try</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    lo <span class="ot">=</span> try</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-output-from-this-loop" class="level2">
<h2 class="anchored" data-anchor-id="the-output-from-this-loop">The output from this loop</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 210.00000000   0.09873715
[1] 215.00000000   0.06142835
[1] 217.50000000   0.04277395
[1] 216.25000000   0.04277395
[1] 215.62500000   0.04277395</code></pre>
</div>
</div>
<ul>
<li>215 inside, 215.625 outside. Upper end of interval to this accuracy is 215.</li>
</ul>
</section>
<section id="using-smmr" class="level2">
<h2 class="anchored" data-anchor-id="using-smmr">Using smmr</h2>
<ul>
<li><code>smmr</code> has function <code>ci_median</code> that does this (by default 95% CI):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ci_median</span>(irs, Time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 119.0065 214.9955</code></pre>
</div>
</div>
<ul>
<li>Uses a more accurate bisection than we did.</li>
<li>Or get, say, 90% CI for median:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ci_median</span>(irs, Time, <span class="at">conf.level=</span><span class="fl">0.90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 123.0031 208.9960</code></pre>
</div>
</div>
<ul>
<li>90% CI is shorter, as it should be.</li>
</ul>
</section>
<section id="bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="bootstrap">Bootstrap</h2>
<ul>
<li>but, was the sample size (30) big enough to overcome the skewness?</li>
<li>Bootstrap, again:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">sim =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">my_sample =</span> <span class="fu">list</span>(<span class="fu">sample</span>(irs<span class="sc">$</span>Time, <span class="at">replace =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">my_mean =</span> <span class="fu">mean</span>(my_sample)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>my_mean)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>) <span class="ot">-&gt;</span> g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-sampling-distribution" class="level2">
<h2 class="anchored" data-anchor-id="the-sampling-distribution">The sampling distribution</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inference_3_files/figure-html/inference-3-R-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comments-1" class="level2">
<h2 class="anchored" data-anchor-id="comments-1">Comments</h2>
<ul>
<li>A little skewed to right, but not nearly as much as I was expecting.</li>
<li>The <span class="math inline">\(t\)</span>-test for the mean might actually be OK for these data, <em>if the mean is what you want</em>.</li>
<li>In actual data, mean and median very different; we chose to make inference about the median.</li>
<li>Thus for us it was right to use the sign test.</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>