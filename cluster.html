<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Cluster analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="cluster_files/libs/clipboard/clipboard.min.js"></script>
<script src="cluster_files/libs/quarto-html/quarto.js"></script>
<script src="cluster_files/libs/quarto-html/popper.min.js"></script>
<script src="cluster_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cluster_files/libs/quarto-html/anchor.min.js"></script>
<link href="cluster_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cluster_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cluster_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cluster_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cluster_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="cluster.html"><i class="bi bi-file-slides"></i>RevealJS</a></li><li><a href="cluster.pdf"><i class="bi bi-file-pdf"></i>Beamer</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cluster analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="cluster-analysis" class="level2">
<h2 class="anchored" data-anchor-id="cluster-analysis">Cluster Analysis</h2>
<ul>
<li><p>One side-effect of discriminant analysis: could draw picture of data (if 1st 2s <code>LD</code>s told most of story) and see which individuals “close” to each other.</p></li>
<li><p>Discriminant analysis requires knowledge of groups.</p></li>
<li><p>Without knowledge of groups, use <em>cluster analysis</em>: see which individuals close together, which groups suggested by data.</p></li>
<li><p>Idea: see how individuals group into “clusters” of nearby individuals.</p></li>
<li><p>Base on “dissimilarities” between individuals.</p></li>
<li><p>Or base on standard deviations and correlations between variables (assesses dissimilarity behind scenes).</p></li>
</ul>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS) <span class="co"># for lda later</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat) <span class="co"># for crossdist later</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conflicted)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"select"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="one-to-ten-in-11-languages" class="level2">
<h2 class="anchored" data-anchor-id="one-to-ten-in-11-languages">One to ten in 11 languages</h2>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>English</th>
<th>Norwegian</th>
<th>Danish</th>
<th>Dutch</th>
<th>German</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>one</td>
<td>en</td>
<td>en</td>
<td>een</td>
<td>eins</td>
</tr>
<tr class="even">
<td>2</td>
<td>two</td>
<td>to</td>
<td>to</td>
<td>twee</td>
<td>zwei</td>
</tr>
<tr class="odd">
<td>3</td>
<td>three</td>
<td>tre</td>
<td>tre</td>
<td>drie</td>
<td>drei</td>
</tr>
<tr class="even">
<td>4</td>
<td>four</td>
<td>fire</td>
<td>fire</td>
<td>vier</td>
<td>vier</td>
</tr>
<tr class="odd">
<td>5</td>
<td>five</td>
<td>fem</td>
<td>fem</td>
<td>vijf</td>
<td>funf</td>
</tr>
<tr class="even">
<td>6</td>
<td>six</td>
<td>seks</td>
<td>seks</td>
<td>zes</td>
<td>sechs</td>
</tr>
<tr class="odd">
<td>7</td>
<td>seven</td>
<td>sju</td>
<td>syv</td>
<td>zeven</td>
<td>sieben</td>
</tr>
<tr class="even">
<td>8</td>
<td>eight</td>
<td>atte</td>
<td>otte</td>
<td>acht</td>
<td>acht</td>
</tr>
<tr class="odd">
<td>9</td>
<td>nine</td>
<td>ni</td>
<td>ni</td>
<td>negen</td>
<td>neun</td>
</tr>
<tr class="even">
<td>10</td>
<td>ten</td>
<td>ti</td>
<td>ti</td>
<td>tien</td>
<td>zehn</td>
</tr>
</tbody>
</table>
</section>
<section id="one-to-ten" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="one-to-ten">One to ten</h2>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>French</th>
<th>Spanish</th>
<th>Italian</th>
<th>Polish</th>
<th>Hungarian</th>
<th>Finnish</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>un</td>
<td>uno</td>
<td>uno</td>
<td>jeden</td>
<td>egy</td>
<td>yksi</td>
</tr>
<tr class="even">
<td>2</td>
<td>deux</td>
<td>dos</td>
<td>due</td>
<td>dwa</td>
<td>ketto</td>
<td>kaksi</td>
</tr>
<tr class="odd">
<td>3</td>
<td>trois</td>
<td>tres</td>
<td>tre</td>
<td>trzy</td>
<td>harom</td>
<td>kolme</td>
</tr>
<tr class="even">
<td>4</td>
<td>quatre</td>
<td>cuatro</td>
<td>quattro</td>
<td>cztery</td>
<td>negy</td>
<td>nelja</td>
</tr>
<tr class="odd">
<td>5</td>
<td>cinq</td>
<td>cinco</td>
<td>cinque</td>
<td>piec</td>
<td>ot</td>
<td>viisi</td>
</tr>
<tr class="even">
<td>6</td>
<td>six</td>
<td>seis</td>
<td>sei</td>
<td>szesc</td>
<td>hat</td>
<td>kuusi</td>
</tr>
<tr class="odd">
<td>7</td>
<td>sept</td>
<td>siete</td>
<td>sette</td>
<td>siedem</td>
<td>het</td>
<td>seitseman</td>
</tr>
<tr class="even">
<td>8</td>
<td>huit</td>
<td>ocho</td>
<td>otto</td>
<td>osiem</td>
<td>nyolc</td>
<td>kahdeksan</td>
</tr>
<tr class="odd">
<td>9</td>
<td>neuf</td>
<td>nueve</td>
<td>nove</td>
<td>dziewiec</td>
<td>kilenc</td>
<td>yhdeksan</td>
</tr>
<tr class="even">
<td>10</td>
<td>dix</td>
<td>diez</td>
<td>dieci</td>
<td>dziesiec</td>
<td>tiz</td>
<td>kymmenen</td>
</tr>
</tbody>
</table>
</section>
<section id="dissimilarities-and-languages-example" class="level2">
<h2 class="anchored" data-anchor-id="dissimilarities-and-languages-example">Dissimilarities and languages example</h2>
<ul>
<li><p>Can define dissimilarities how you like (whatever makes sense in application).</p></li>
<li><p>Sometimes defining “similarity” makes more sense; can turn this into dissimilarity by subtracting from some maximum.</p></li>
<li><p>Example: numbers 1–10 in various European languages. Define similarity between two languages by counting how often the same number has a name starting with the same letter (and dissimilarity by how often number has names starting with different letter).</p></li>
<li><p>Crude (doesn’t even look at most of the words), but see how effective.</p></li>
</ul>
</section>
<section id="two-kinds-of-cluster-analysis" class="level2">
<h2 class="anchored" data-anchor-id="two-kinds-of-cluster-analysis">Two kinds of cluster analysis</h2>
<ul>
<li><p>Looking at process of forming clusters (of similar languages): <strong>hierarchical cluster analysis</strong> (<code>hclust</code>).</p></li>
<li><p>Start with each individual in cluster by itself.</p></li>
<li><p>Join “closest” clusters one by one until all individuals in one cluster.</p></li>
<li><p>How to define closeness of two <em>clusters</em>? Not obvious, investigate in a moment.</p></li>
<li><p>Know how many clusters: which division into that many clusters is “best” for individuals? <strong>K-means clustering</strong> (<code>kmeans</code>).</p></li>
</ul>
</section>
<section id="two-made-up-clusters" class="level2">
<h2 class="anchored" data-anchor-id="two-made-up-clusters">Two made-up clusters</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How to measure distance between set of red points and set of blue ones?</p>
</section>
<section id="single-linkage-distance" class="level2">
<h2 class="anchored" data-anchor-id="single-linkage-distance">Single-linkage distance</h2>
<p>Find the red point and the blue point that are closest together:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Single-linkage distance between 2 clusters is distance between their closest points.</p>
</section>
<section id="complete-linkage" class="level2">
<h2 class="anchored" data-anchor-id="complete-linkage">Complete linkage</h2>
<p>Find the red and blue points that are farthest apart:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Complete-linkage distance is distance between farthest points.</p>
</section>
<section id="wards-method" class="level2">
<h2 class="anchored" data-anchor-id="wards-method">Ward’s method</h2>
<p>Work out mean of each cluster and join point to its mean:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Work out (i) sum of squared distances of points from means.</p>
</section>
<section id="wards-method-part-2" class="level2">
<h2 class="anchored" data-anchor-id="wards-method-part-2">Ward’s method part 2</h2>
<p>Now imagine combining the two clusters and working out overall mean. Join each point to this mean:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Calc sum of squared distances (ii) of points to combined mean.</p>
</section>
<section id="wards-method-part-3" class="level2">
<h2 class="anchored" data-anchor-id="wards-method-part-3">Ward’s method part 3</h2>
<ul>
<li><p>Sum of squares (ii) will be bigger than (i) (points closer to own cluster mean than combined mean).</p></li>
<li><p>Ward’s distance is (ii) minus (i).</p></li>
<li><p>Think of as “cost” of combining clusters:</p></li>
<li><p>if clusters close together, (ii) only a little larger than (i)</p></li>
<li><p>if clusters far apart, (ii) a lot larger than (i) (as in example).</p></li>
</ul>
</section>
<section id="hierarchical-clustering-revisited" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-clustering-revisited">Hierarchical clustering revisited</h2>
<ul>
<li><p>Single linkage, complete linkage, Ward are ways of measuring closeness of clusters.</p></li>
<li><p>Use them, starting with each observation in own cluster, to repeatedly combine two closest clusters until all points in one cluster.</p></li>
<li><p>They will give different answers (clustering stories).</p></li>
<li><p>Single linkage tends to make “stringy” clusters because clusters can be very different apart from two closest points.</p></li>
<li><p>Complete linkage insists on whole clusters being similar.</p></li>
<li><p>Ward tends to form many small clusters first.</p></li>
</ul>
</section>
<section id="dissimilarity-data-in-r" class="level2">
<h2 class="anchored" data-anchor-id="dissimilarity-data-in-r">Dissimilarity data in R</h2>
<p>Dissimilarities for language data were how many number names had <em>different</em> first letter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/languages.txt"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>(number.d <span class="ot">&lt;-</span> <span class="fu">read_table</span>(my_url))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 12
   la       en    no    dk    nl    de    fr    es    it
   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 en        0     2     2     7     6     6     6     6
 2 no        2     0     1     5     4     6     6     6
 3 dk        2     1     0     6     5     6     5     5
 4 nl        7     5     6     0     5     9     9     9
 5 de        6     4     5     5     0     7     7     7
 6 fr        6     6     6     9     7     0     2     1
 7 es        6     6     5     9     7     2     0     1
 8 it        6     6     5     9     7     1     1     0
 9 pl        7     7     6    10     8     5     3     4
10 hu        9     8     8     8     9    10    10    10
11 fi        9     9     9     9     9     9     9     8
# ℹ 3 more variables: pl &lt;dbl&gt;, hu &lt;dbl&gt;, fi &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="making-a-distance-object" class="level2">
<h2 class="anchored" data-anchor-id="making-a-distance-object">Making a distance object</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>number.d <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>la) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.dist</span>() <span class="ot">-&gt;</span> d</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   en no dk nl de fr es it pl hu
no  2                           
dk  2  1                        
nl  7  5  6                     
de  6  4  5  5                  
fr  6  6  6  9  7               
es  6  6  5  9  7  2            
it  6  6  5  9  7  1  1         
pl  7  7  6 10  8  5  3  4      
hu  9  8  8  8  9 10 10 10 10   
fi  9  9  9  9  9  9  9  8  9  8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "dist"</code></pre>
</div>
</div>
</section>
<section id="cluster-analysis-and-dendrogram" class="level2">
<h2 class="anchored" data-anchor-id="cluster-analysis-and-dendrogram">Cluster analysis and dendrogram</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>d.hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> <span class="st">"single"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d.hc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comments" class="level2">
<h2 class="anchored" data-anchor-id="comments">Comments</h2>
<ul>
<li><p>Tree shows how languages combined into clusters.</p></li>
<li><p>First (bottom), Spanish, French, Italian joined into one cluster, Norwegian and Danish into another.</p></li>
<li><p>Later, English joined to Norse languages, Polish to Romance group.</p></li>
<li><p>Then German, Dutch make a Germanic group.</p></li>
<li><p>Finally, Hungarian and Finnish joined to each other and everything else.</p></li>
</ul>
</section>
<section id="clustering-process" class="level2">
<h2 class="anchored" data-anchor-id="clustering-process">Clustering process</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>d.hc<span class="sc">$</span>labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "en" "no" "dk" "nl" "de" "fr" "es" "it" "pl" "hu" "fi"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>d.hc<span class="sc">$</span>merge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2]
 [1,]   -2   -3
 [2,]   -6   -8
 [3,]   -7    2
 [4,]   -1    1
 [5,]   -9    3
 [6,]   -5    4
 [7,]   -4    6
 [8,]    5    7
 [9,]  -10    8
[10,]  -11    9</code></pre>
</div>
</div>
</section>
<section id="comments-1" class="level2">
<h2 class="anchored" data-anchor-id="comments-1">Comments</h2>
<ul>
<li><p>Lines of <code>merge</code> show what was combined</p>
<ul>
<li><p>First, languages 2 and 3 (<code>no</code> and <code>dk</code>)</p></li>
<li><p>Then languages 6 and 8 (<code>fr</code> and <code>it</code>)</p></li>
<li><p>Then #7 combined with cluster formed at step 2 (<code>es</code> joined to <code>fr</code> and <code>it</code>).</p></li>
<li><p>Then <code>en</code> joined to <code>no</code> and <code>dk</code> </p></li>
<li><p>Finally <code>fi</code> joined to all others.</p></li>
</ul></li>
</ul>
</section>
<section id="complete-linkage-1" class="level2">
<h2 class="anchored" data-anchor-id="complete-linkage-1">Complete linkage</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>d.hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d.hc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="ward" class="level2">
<h2 class="anchored" data-anchor-id="ward">Ward</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>d.hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> <span class="st">"ward.D"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d.hc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/wardo-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="chopping-the-tree" class="level2">
<h2 class="anchored" data-anchor-id="chopping-the-tree">Chopping the tree</h2>
<ul>
<li>Three clusters (from Ward) looks good:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cutree</span>(d.hc, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>en no dk nl de fr es it pl hu fi 
 1  1  1  1  1  2  2  2  2  3  3 </code></pre>
</div>
</div>
</section>
<section id="turning-the-named-vector-into-a-data-frame" class="level2">
<h2 class="anchored" data-anchor-id="turning-the-named-vector-into-a-data-frame">Turning the “named vector” into a data frame</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cutree</span>(d.hc, <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">enframe</span>(<span class="at">name=</span><span class="st">"country"</span>, <span class="at">value=</span><span class="st">"cluster"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   country cluster
   &lt;chr&gt;     &lt;int&gt;
 1 en            1
 2 no            1
 3 dk            1
 4 nl            1
 5 de            1
 6 fr            2
 7 es            2
 8 it            2
 9 pl            2
10 hu            3
11 fi            3</code></pre>
</div>
</div>
</section>
<section id="drawing-those-clusters-on-the-tree" class="level2">
<h2 class="anchored" data-anchor-id="drawing-those-clusters-on-the-tree">Drawing those clusters on the tree</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d.hc)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rect.hclust</span>(d.hc, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/asfsagd-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comparing-single-linkage-and-ward" class="level2">
<h2 class="anchored" data-anchor-id="comparing-single-linkage-and-ward">Comparing single-linkage and Ward</h2>
<ul>
<li><p>In Ward, Dutch and German get joined earlier (before joining to Germanic cluster).</p></li>
<li><p>Also Hungarian and Finnish get combined earlier.</p></li>
</ul>
</section>
<section id="making-those-dissimilarities" class="level2">
<h2 class="anchored" data-anchor-id="making-those-dissimilarities">Making those dissimilarities</h2>
<p>Original data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/one-ten.txt"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>lang <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">" "</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>lang</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 11
   en    no    dk    nl    de     fr     es     it     pl   
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;
 1 one   en    en    een   eins   un     uno    uno    jeden
 2 two   to    to    twee  zwei   deux   dos    due    dwa  
 3 three tre   tre   drie  drei   trois  tres   tre    trzy 
 4 four  fire  fire  vier  vier   quatre cuatro quatt… czte…
 5 five  fem   fem   vijf  funf   cinq   cinco  cinque piec 
 6 six   seks  seks  zes   sechs  six    seis   sei    szesc
 7 seven sju   syv   zeven sieben sept   siete  sette  sied…
 8 eight atte  otte  acht  acht   huit   ocho   otto   osiem
 9 nine  ni    ni    negen neun   neuf   nueve  nove   dzie…
10 ten   ti    ti    tien  zehn   dix    diez   dieci  dzie…
# ℹ 2 more variables: hu &lt;chr&gt;, fi &lt;chr&gt;</code></pre>
</div>
</div>
<p>It would be a lot easier to extract the first letter if the number names were all in one column.</p>
</section>
<section id="tidy-and-extract-first-letter" class="level2">
<h2 class="anchored" data-anchor-id="tidy-and-extract-first-letter">Tidy, and extract first letter</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lang <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">number=</span><span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>number, <span class="at">names_to=</span><span class="st">"language"</span>, <span class="at">values_to=</span><span class="st">"name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">first=</span><span class="fu">str_sub</span>(name, <span class="dv">1</span>, <span class="dv">1</span>)) <span class="ot">-&gt;</span> lang.long</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>lang.long </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 110 × 4
   number language name  first
    &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
 1      1 en       one   o    
 2      1 no       en    e    
 3      1 dk       en    e    
 4      1 nl       een   e    
 5      1 de       eins  e    
 6      1 fr       un    u    
 7      1 es       uno   u    
 8      1 it       uno   u    
 9      1 pl       jeden j    
10      1 hu       egy   e    
# ℹ 100 more rows</code></pre>
</div>
</div>
</section>
<section id="calculating-dissimilarity" class="level2">
<h2 class="anchored" data-anchor-id="calculating-dissimilarity">Calculating dissimilarity</h2>
<ul>
<li><p>Suppose we wanted dissimilarity between English and Norwegian. It’s the number of first letters that are different.</p></li>
<li><p>First get the lines for English:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>english <span class="ot">&lt;-</span> lang.long <span class="sc">%&gt;%</span> <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"en"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>english</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   number language name  first
    &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
 1      1 en       one   o    
 2      2 en       two   t    
 3      3 en       three t    
 4      4 en       four  f    
 5      5 en       five  f    
 6      6 en       six   s    
 7      7 en       seven s    
 8      8 en       eight e    
 9      9 en       nine  n    
10     10 en       ten   t    </code></pre>
</div>
</div>
</section>
<section id="and-then-the-lines-for-norwegian" class="level2">
<h2 class="anchored" data-anchor-id="and-then-the-lines-for-norwegian">And then the lines for Norwegian</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>norwegian <span class="ot">&lt;-</span> lang.long <span class="sc">%&gt;%</span> <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"no"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>norwegian</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   number language name  first
    &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
 1      1 no       en    e    
 2      2 no       to    t    
 3      3 no       tre   t    
 4      4 no       fire  f    
 5      5 no       fem   f    
 6      6 no       seks  s    
 7      7 no       sju   s    
 8      8 no       atte  a    
 9      9 no       ni    n    
10     10 no       ti    t    </code></pre>
</div>
</div>
<p>And now we want to put them side by side, matched by number. This is what <code>left_join</code> does. (A “join” is a lookup of values in one table using another.)</p>
</section>
<section id="the-join" class="level2">
<h2 class="anchored" data-anchor-id="the-join">The join</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>english <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(norwegian, <span class="fu">join_by</span>(number))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
   number language.x name.x first.x language.y name.y first.y
    &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;  
 1      1 en         one    o       no         en     e      
 2      2 en         two    t       no         to     t      
 3      3 en         three  t       no         tre    t      
 4      4 en         four   f       no         fire   f      
 5      5 en         five   f       no         fem    f      
 6      6 en         six    s       no         seks   s      
 7      7 en         seven  s       no         sju    s      
 8      8 en         eight  e       no         atte   a      
 9      9 en         nine   n       no         ni     n      
10     10 en         ten    t       no         ti     t      </code></pre>
</div>
</div>
<p><code>first.x</code> is 1st letter of English word, <code>first.y</code> 1st letter of Norwegian word.</p>
</section>
<section id="counting-the-different-ones" class="level2">
<h2 class="anchored" data-anchor-id="counting-the-different-ones">Counting the different ones</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>english <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(norwegian, <span class="fu">join_by</span>(number)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">different=</span>(first.x <span class="sc">!=</span> first.y)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  different     n
  &lt;lgl&gt;     &lt;int&gt;
1 FALSE         8
2 TRUE          2</code></pre>
</div>
</div>
<p>or</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>english <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(norwegian, <span class="fu">join_by</span>(number)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">different=</span>(first.x <span class="sc">!=</span> first.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(different) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(n) <span class="ot">-&gt;</span> ans</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>ans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>Words for 1 and 8 start with different letter; rest are same.</p>
</section>
<section id="a-language-with-itself" class="level2">
<h2 class="anchored" data-anchor-id="a-language-with-itself">A language with itself</h2>
<p>The answer should be zero:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>english <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(english, <span class="fu">join_by</span>(number)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">different=</span>(first.x <span class="sc">!=</span> first.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(different) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(n) <span class="ot">-&gt;</span> ans</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>ans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>integer(0)</code></pre>
</div>
</div>
<ul>
<li>but this is “an integer vector of length zero”.</li>
<li>so we have to allow for this possibility when we write a function to do it.</li>
</ul>
</section>
<section id="function-to-do-this-for-any-two-languages" class="level2">
<h2 class="anchored" data-anchor-id="function-to-do-this-for-any-two-languages">Function to do this for any two languages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>countdiff <span class="ot">&lt;-</span> <span class="cf">function</span>(lang<span class="fl">.1</span>, lang<span class="fl">.2</span>, d) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(language <span class="sc">==</span> lang<span class="fl">.1</span>) <span class="ot">-&gt;</span> lang1d</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(language <span class="sc">==</span> lang<span class="fl">.2</span>) <span class="ot">-&gt;</span> lang2d</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  lang1d <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(lang2d, <span class="fu">join_by</span>(number)) <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">different =</span> (first.x <span class="sc">!=</span> first.y)) <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(different) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(n) <span class="ot">-&gt;</span> ans</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if ans has length zero, set answer to (integer) zero.</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(<span class="fu">length</span>(ans)<span class="sc">==</span><span class="dv">0</span>, 0L, ans) </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="testing" class="level2">
<h2 class="anchored" data-anchor-id="testing">Testing</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">countdiff</span>(<span class="st">"en"</span>, <span class="st">"no"</span>, lang.long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">countdiff</span>(<span class="st">"en"</span>, <span class="st">"en"</span>, lang.long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>English and Norwegian have two different; English and English have none different.</p>
<p>Check.</p>
</section>
<section id="for-all-pairs-of-languages" class="level2">
<h2 class="anchored" data-anchor-id="for-all-pairs-of-languages">For all pairs of languages?</h2>
<ul>
<li>First need all the languages:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>languages <span class="ot">&lt;-</span> <span class="fu">names</span>(lang)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>languages</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "en" "no" "dk" "nl" "de" "fr" "es" "it" "pl"
[10] "hu" "fi"</code></pre>
</div>
</div>
<ul>
<li>and then all <em>pairs</em> of languages:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>pairs <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">lang =</span> languages, <span class="at">lang2 =</span> languages) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-pairs" class="level2">
<h2 class="anchored" data-anchor-id="the-pairs">The pairs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pairs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 121 × 2
   lang  lang2
   &lt;chr&gt; &lt;chr&gt;
 1 de    de   
 2 de    dk   
 3 de    en   
 4 de    es   
 5 de    fi   
 6 de    fr   
 7 de    hu   
 8 de    it   
 9 de    nl   
10 de    no   
# ℹ 111 more rows</code></pre>
</div>
</div>
</section>
<section id="run-countdiff-for-all-those-language-pairs" class="level2">
<h2 class="anchored" data-anchor-id="run-countdiff-for-all-those-language-pairs">Run <code>countdiff</code> for all those language pairs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>pairs <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> <span class="fu">countdiff</span>(lang, lang2, lang.long)) <span class="ot">-&gt;</span> thediff</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>thediff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 121 × 3
# Rowwise: 
   lang  lang2  diff
   &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
 1 de    de        0
 2 de    dk        5
 3 de    en        6
 4 de    es        7
 5 de    fi        9
 6 de    fr        7
 7 de    hu        9
 8 de    it        7
 9 de    nl        5
10 de    no        4
# ℹ 111 more rows</code></pre>
</div>
</div>
</section>
<section id="make-square-table-of-these" class="level2">
<h2 class="anchored" data-anchor-id="make-square-table-of-these">Make square table of these</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>thediff <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>lang2, <span class="at">values_from=</span>diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 12
   lang     de    dk    en    es    fi    fr    hu    it
   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1 de        0     5     6     7     9     7     9     7
 2 dk        5     0     2     5     9     6     8     5
 3 en        6     2     0     6     9     6     9     6
 4 es        7     5     6     0     9     2    10     1
 5 fi        9     9     9     9     0     9     8     9
 6 fr        7     6     6     2     9     0    10     1
 7 hu        9     8     9    10     8    10     0    10
 8 it        7     5     6     1     9     1    10     0
 9 nl        5     6     7     9     9     9     8     9
10 no        4     1     2     6     9     6     8     6
11 pl        8     6     7     3     9     5    10     4
# ℹ 3 more variables: nl &lt;int&gt;, no &lt;int&gt;, pl &lt;int&gt;</code></pre>
</div>
</div>
<p>and that was where we began.</p>
</section>
<section id="another-example" class="level2">
<h2 class="anchored" data-anchor-id="another-example">Another example</h2>
<p>Birth, death and infant mortality rates for 97 countries (variables not dissimilarities):</p>
<pre><code>24.7  5.7  30.8 Albania         12.5 11.9  14.4 Bulgaria
13.4 11.7  11.3 Czechoslovakia  12   12.4   7.6 Former_E._Germany
11.6 13.4  14.8 Hungary         14.3 10.2    16 Poland
13.6 10.7  26.9 Romania           14    9  20.2 Yugoslavia
17.7   10    23 USSR            15.2  9.5  13.1 Byelorussia_SSR
13.4 11.6    13 Ukrainian_SSR   20.7  8.4  25.7 Argentina
46.6   18   111 Bolivia         28.6  7.9    63 Brazil
23.4  5.8  17.1 Chile           27.4  6.1    40 Columbia
32.9  7.4    63 Ecuador         28.3  7.3    56 Guyana
...</code></pre>
<ul>
<li><p>Want to find groups of similar countries (and how many groups, which countries in each group).</p></li>
<li><p>Tree would be unwieldy with 97 countries.</p></li>
<li><p>More automatic way of finding given number of clusters?</p></li>
</ul>
</section>
<section id="reading-in" class="level2">
<h2 class="anchored" data-anchor-id="reading-in">Reading in</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/birthrate.txt"</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>vital <span class="ot">&lt;-</span> <span class="fu">read_table</span>(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
── Column specification ────────────────────────────────────
cols(
  birth = col_double(),
  death = col_double(),
  infant = col_double(),
  country = col_character()
)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>vital</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 97 × 4
   birth death infant country       
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;         
 1  24.7   5.7   30.8 Albania       
 2  13.4  11.7   11.3 Czechoslovakia
 3  11.6  13.4   14.8 Hungary       
 4  13.6  10.7   26.9 Romania       
 5  17.7  10     23   USSR          
 6  13.4  11.6   13   Ukrainian_SSR 
 7  46.6  18    111   Bolivia       
 8  23.4   5.8   17.1 Chile         
 9  32.9   7.4   63   Ecuador       
10  34.8   6.6   42   Paraguay      
# ℹ 87 more rows</code></pre>
</div>
</div>
</section>
<section id="standardizing" class="level2">
<h2 class="anchored" data-anchor-id="standardizing">Standardizing</h2>
<ul>
<li><p>Infant mortality rate numbers bigger than others, consequence of measurement scale (arbitrary).</p></li>
<li><p>Standardize (numerical) columns of data frame to have mean 0, SD 1, done by <code>scale</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>vital <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), \(x) <span class="fu">scale</span>(x))) <span class="ot">-&gt;</span> vital.s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="three-clusters" class="level2">
<h2 class="anchored" data-anchor-id="three-clusters">Three clusters</h2>
<p>Pretend we know 3 clusters is good. Take off the column of countries, and run <code>kmeans</code> on the resulting data frame, asking for 3 clusters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>vital.s <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>country) <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(<span class="dv">3</span>) <span class="ot">-&gt;</span> vital.km3</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vital.km3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cluster"      "centers"      "totss"       
[4] "withinss"     "tot.withinss" "betweenss"   
[7] "size"         "iter"         "ifault"      </code></pre>
</div>
</div>
<p>A lot of output, so look at these individually.</p>
</section>
<section id="whats-in-the-output" class="level2">
<h2 class="anchored" data-anchor-id="whats-in-the-output">What’s in the output?</h2>
<ul>
<li>Cluster sizes:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>vital.km3<span class="sc">$</span>size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40 25 32</code></pre>
</div>
</div>
<ul>
<li>Cluster centres:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>vital.km3<span class="sc">$</span>centers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       birth      death      infant
1 -1.0376994 -0.3289046 -0.90669032
2  1.1780071  1.3323130  1.32732200
3  0.3768062 -0.6297388  0.09639258</code></pre>
</div>
</div>
<ul>
<li>Cluster 2 has lower than average rates on everything; cluster 3 has much higher than average.</li>
</ul>
</section>
<section id="cluster-sums-of-squares-and-membership" class="level2">
<h2 class="anchored" data-anchor-id="cluster-sums-of-squares-and-membership">Cluster sums of squares and membership</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>vital.km3<span class="sc">$</span>withinss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17.21617 28.32560 21.53020</code></pre>
</div>
</div>
<p>Cluster 1 compact relative to others (countries in cluster 1 more similar).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>vital.km3<span class="sc">$</span>cluster</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 3 1 1 1 1 1 2 1 3 3 1 2 1 1 1 1 1 1 1 1 1 2 2 1 3 3 3 2
[29] 1 3 1 3 3 1 1 3 3 3 2 2 3 3 2 2 3 2 2 2 3 1 1 1 1 1 1 3
[57] 3 3 3 3 1 1 1 1 1 1 1 1 1 1 3 3 3 3 3 1 2 1 3 3 2 3 1 3
[85] 2 2 2 2 3 2 2 2 2 2 3 2 2</code></pre>
</div>
</div>
<p>The cluster membership for each of the 97 countries.</p>
</section>
<section id="store-countries-and-clusters-to-which-they-belong" class="level2">
<h2 class="anchored" data-anchor-id="store-countries-and-clusters-to-which-they-belong">Store countries and clusters to which they belong</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>vital<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> vital.s<span class="sc">$</span>country,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> vital.km3<span class="sc">$</span>cluster</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, which countries in which cluster?</p>
<p>Write function to extract them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>get_countries <span class="ot">&lt;-</span> <span class="cf">function</span>(i, d) {</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cluster <span class="sc">==</span> i) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(country)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cluster-membership-cluster-2" class="level2">
<h2 class="anchored" data-anchor-id="cluster-membership-cluster-2">Cluster membership: cluster 2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_countries</span>(<span class="dv">2</span>, vital<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Bolivia"      "Mexico"       "Afghanistan" 
 [4] "Iran"         "Bangladesh"   "Gabon"       
 [7] "Ghana"        "Namibia"      "Sierra_Leone"
[10] "Swaziland"    "Uganda"       "Zaire"       
[13] "Cambodia"     "Nepal"        "Angola"      
[16] "Congo"        "Ethiopia"     "Gambia"      
[19] "Malawi"       "Mozambique"   "Nigeria"     
[22] "Somalia"      "Sudan"        "Tanzania"    
[25] "Zambia"      </code></pre>
</div>
</div>
</section>
<section id="cluster-3" class="level2">
<h2 class="anchored" data-anchor-id="cluster-3">Cluster 3</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_countries</span>(<span class="dv">3</span>, vital<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Albania"      "Ecuador"      "Paraguay"    
 [4] "Kuwait"       "Oman"         "Turkey"      
 [7] "India"        "Mongolia"     "Pakistan"    
[10] "Algeria"      "Botswana"     "Egypt"       
[13] "Libya"        "Morocco"      "South_Africa"
[16] "Zimbabwe"     "Brazil"       "Columbia"    
[19] "Guyana"       "Peru"         "Venezuela"   
[22] "Bahrain"      "Iraq"         "Jordan"      
[25] "Lebanon"      "Saudi_Arabia" "Indonesia"   
[28] "Malaysia"     "Philippines"  "Vietnam"     
[31] "Kenya"        "Tunisia"     </code></pre>
</div>
</div>
</section>
<section id="cluster-1" class="level2">
<h2 class="anchored" data-anchor-id="cluster-1">Cluster 1</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_countries</span>(<span class="dv">1</span>, vital<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Czechoslovakia"       "Hungary"             
 [3] "Romania"              "USSR"                
 [5] "Ukrainian_SSR"        "Chile"               
 [7] "Uruguay"              "Finland"             
 [9] "France"               "Greece"              
[11] "Italy"                "Norway"              
[13] "Spain"                "Switzerland"         
[15] "Austria"              "Canada"              
[17] "Israel"               "China"               
[19] "Korea"                "Singapore"           
[21] "Thailand"             "Bulgaria"            
[23] "Former_E._Germany"    "Poland"              
[25] "Yugoslavia"           "Byelorussia_SSR"     
[27] "Argentina"            "Belgium"             
[29] "Denmark"              "Germany"             
[31] "Ireland"              "Netherlands"         
[33] "Portugal"             "Sweden"              
[35] "U.K."                 "Japan"               
[37] "U.S.A."               "United_Arab_Emirates"
[39] "Hong_Kong"            "Sri_Lanka"           </code></pre>
</div>
</div>
</section>
<section id="problem" class="level2">
<h2 class="anchored" data-anchor-id="problem">Problem!</h2>
<ul>
<li><p><code>kmeans</code> uses randomization. So result of one run might be different from another run.</p></li>
<li><p>Example: just run again on 3 clusters, <code>table</code> of results:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>vital.s <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>country) <span class="sc">%&gt;%</span> <span class="fu">kmeans</span>(<span class="dv">3</span>) <span class="ot">-&gt;</span> vital.km3a</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">first =</span> vital.km3<span class="sc">$</span>cluster,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">second =</span> vital.km3a<span class="sc">$</span>cluster</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     second
first  1  2  3
    1 40  0  0
    2  0 24  1
    3  4  0 28</code></pre>
</div>
</div>
<ul>
<li>Clusters are similar but <em>not same</em>.</li>
</ul>
</section>
<section id="solution-to-this" class="level2">
<h2 class="anchored" data-anchor-id="solution-to-this">Solution to this</h2>
<ul>
<li><code>nstart</code> option on <code>kmeans</code> runs that many times, takes best. Should be same every time:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>vital.s <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(<span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">20</span>) <span class="ot">-&gt;</span> vital.km3b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-many-clusters" class="level2">
<h2 class="anchored" data-anchor-id="how-many-clusters">How many clusters?</h2>
<ul>
<li><p>Three was just a guess.</p></li>
<li><p>Idea: try a whole bunch of #clusters (say 2–20), obtain measure of goodness of fit for each, make plot.</p></li>
<li><p>Appropriate measure is <code>tot.withinss</code>.</p></li>
<li><p>Run <code>kmeans</code> for each #clusters, get <code>tot.withinss</code> each time.</p></li>
</ul>
</section>
<section id="function-to-get-tot.withinss" class="level2">
<h2 class="anchored" data-anchor-id="function-to-get-tot.withinss">Function to get <code>tot.withinss</code></h2>
<p>for an input number of clusters, taking only numeric columns of input data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="cf">function</span>(i, d) {</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kmeans</span>(i, <span class="at">nstart =</span> <span class="dv">20</span>) <span class="ot">-&gt;</span> km</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  km<span class="sc">$</span>tot.withinss</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: writing function to be as general as possible, so that we can re-use it later.</p>
</section>
<section id="constructing-within-cluster-ss" class="level2">
<h2 class="anchored" data-anchor-id="constructing-within-cluster-ss">Constructing within-cluster SS</h2>
<p>Make a data frame with desired numbers of clusters, and fill it with the total within-group sums of squares. <code>ss</code> expects a single number of clusters, not a vector of several, so run <code>rowwise</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">clusters =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wss =</span> <span class="fu">ss</span>(clusters, vital.s)) <span class="ot">-&gt;</span> ssd</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>ssd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 2
# Rowwise: 
   clusters    wss
      &lt;int&gt;  &lt;dbl&gt;
 1        2 117.  
 2        3  66.9 
 3        4  51.4 
 4        5  37.5 
 5        6  28.7 
 6        7  24.7 
 7        8  22.2 
 8        9  19.8 
 9       10  17.5 
10       11  16.1 
11       12  14.7 
12       13  13.3 
13       14  12.1 
14       15  11.2 
15       16  10.5 
16       17   9.71
17       18   8.98
18       19   8.44
19       20   7.97</code></pre>
</div>
</div>
</section>
<section id="scree-plot" class="level2">
<h2 class="anchored" data-anchor-id="scree-plot">Scree plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ssd, <span class="fu">aes</span>(<span class="at">x =</span> clusters, <span class="at">y =</span> wss)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/favalli-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="interpreting-scree-plot" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-scree-plot">Interpreting scree plot</h2>
<ul>
<li><p>Lower <code>wss</code> better.</p></li>
<li><p>But lower for larger #clusters, harder to explain.</p></li>
<li><p>Compromise: low-ish <code>wss</code> and low-ish #clusters.</p></li>
<li><p>Look for “elbow” in plot.</p></li>
<li><p>Idea: this is where <code>wss</code> decreases fast then slow.</p></li>
<li><p>On our plot, small elbow at 6 clusters. Try this many clusters.</p></li>
</ul>
</section>
<section id="six-clusters-using-nstart" class="level2">
<h2 class="anchored" data-anchor-id="six-clusters-using-nstart">Six clusters, using <code>nstart</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">457299</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>vital.s <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>country) <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(<span class="dv">6</span>, <span class="at">nstart =</span> <span class="dv">20</span>) <span class="ot">-&gt;</span> vital.km6</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>vital.km6<span class="sc">$</span>size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24 18 15  2  8 30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>vital.km6<span class="sc">$</span>centers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       birth      death     infant
1  0.4160993 -0.5169988  0.2648754
2  1.2092406  0.7441347  1.0278003
3 -0.4357690 -1.1438599 -0.7281108
4 -0.2199722  2.1116577 -0.4544435
5  1.3043848  2.1896567  1.9470306
6 -1.1737104 -0.1856375 -0.9534370</code></pre>
</div>
</div>
</section>
<section id="make-a-data-frame-of-countries-and-clusters" class="level2">
<h2 class="anchored" data-anchor-id="make-a-data-frame-of-countries-and-clusters">Make a data frame of countries and clusters</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>vital<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> vital.s<span class="sc">$</span>country,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> vital.km6<span class="sc">$</span>cluster</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>vital<span class="fl">.6</span> <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   country        cluster
   &lt;chr&gt;            &lt;int&gt;
 1 Ghana                2
 2 Ukrainian_SSR        6
 3 Ethiopia             5
 4 Somalia              5
 5 Oman                 1
 6 Botswana             2
 7 Paraguay             1
 8 Czechoslovakia       6
 9 Peru                 1
10 Afghanistan          5</code></pre>
</div>
</div>
</section>
<section id="cluster-1-1" class="level2">
<h2 class="anchored" data-anchor-id="cluster-1-1">Cluster 1</h2>
<p>Below-average death rate, though other rates a little higher than average:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_countries</span>(<span class="dv">1</span>, vital<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Ecuador"      "Paraguay"     "Oman"        
 [4] "Turkey"       "India"        "Mongolia"    
 [7] "Pakistan"     "Algeria"      "Egypt"       
[10] "Libya"        "Morocco"      "South_Africa"
[13] "Zimbabwe"     "Brazil"       "Guyana"      
[16] "Peru"         "Iraq"         "Jordan"      
[19] "Lebanon"      "Saudi_Arabia" "Indonesia"   
[22] "Philippines"  "Vietnam"      "Tunisia"     </code></pre>
</div>
</div>
</section>
<section id="cluster-2" class="level2">
<h2 class="anchored" data-anchor-id="cluster-2">Cluster 2</h2>
<p>High on everything:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_countries</span>(<span class="dv">2</span>, vital<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Bolivia"    "Iran"       "Bangladesh" "Botswana"  
 [5] "Gabon"      "Ghana"      "Namibia"    "Swaziland" 
 [9] "Uganda"     "Zaire"      "Cambodia"   "Nepal"     
[13] "Congo"      "Kenya"      "Nigeria"    "Sudan"     
[17] "Tanzania"   "Zambia"    </code></pre>
</div>
</div>
</section>
<section id="cluster-3-1" class="level2">
<h2 class="anchored" data-anchor-id="cluster-3-1">Cluster 3</h2>
<p>Low on everything: </p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_countries</span>(<span class="dv">3</span>, vital<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Albania"              "Chile"               
 [3] "Israel"               "Kuwait"              
 [5] "China"                "Singapore"           
 [7] "Thailand"             "Argentina"           
 [9] "Columbia"             "Venezuela"           
[11] "Bahrain"              "United_Arab_Emirates"
[13] "Hong_Kong"            "Malaysia"            
[15] "Sri_Lanka"           </code></pre>
</div>
</div>
</section>
<section id="cluster-4" class="level2">
<h2 class="anchored" data-anchor-id="cluster-4">Cluster 4</h2>
<p>Very high death rate, just below average on all else:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_countries</span>(<span class="dv">4</span>, vital<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mexico" "Korea" </code></pre>
</div>
</div>
</section>
<section id="cluster-5" class="level2">
<h2 class="anchored" data-anchor-id="cluster-5">Cluster 5</h2>
<p>Very high on everything:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_countries</span>(<span class="dv">5</span>, vital<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Afghanistan"  "Sierra_Leone" "Angola"      
[4] "Ethiopia"     "Gambia"       "Malawi"      
[7] "Mozambique"   "Somalia"     </code></pre>
</div>
</div>
</section>
<section id="cluster-6" class="level2">
<h2 class="anchored" data-anchor-id="cluster-6">Cluster 6</h2>
<p>A bit below average on everything:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_countries</span>(<span class="dv">6</span>, vital<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Czechoslovakia"    "Hungary"          
 [3] "Romania"           "USSR"             
 [5] "Ukrainian_SSR"     "Uruguay"          
 [7] "Finland"           "France"           
 [9] "Greece"            "Italy"            
[11] "Norway"            "Spain"            
[13] "Switzerland"       "Austria"          
[15] "Canada"            "Bulgaria"         
[17] "Former_E._Germany" "Poland"           
[19] "Yugoslavia"        "Byelorussia_SSR"  
[21] "Belgium"           "Denmark"          
[23] "Germany"           "Ireland"          
[25] "Netherlands"       "Portugal"         
[27] "Sweden"            "U.K."             
[29] "Japan"             "U.S.A."           </code></pre>
</div>
</div>
</section>
<section id="comparing-our-3-and-6-cluster-solutions" class="level2">
<h2 class="anchored" data-anchor-id="comparing-our-3-and-6-cluster-solutions">Comparing our 3 and 6-cluster solutions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">three =</span> vital.km3<span class="sc">$</span>cluster, <span class="at">six =</span> vital.km6<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     six
three  1  2  3  4  5  6
    1  0  0  9  1  0 30
    2  0 16  0  1  8  0
    3 24  2  6  0  0  0</code></pre>
</div>
</div>
<p>Compared to 3-cluster solution:</p>
<ul>
<li><p>most of (old) cluster 1 gone to (new) cluster 6</p></li>
<li><p>cluster 2 split into clusters 2 and 5 (two types of “poor” countries)</p></li>
<li><p>cluster 3 split into clusters 1 and 3 (two types of “intermediate” countries, divided by death rate).</p></li>
</ul>
</section>
<section id="getting-a-picture-from-kmeans" class="level2">
<h2 class="anchored" data-anchor-id="getting-a-picture-from-kmeans">Getting a picture from <code>kmeans</code></h2>
<ul>
<li>Use discriminant analysis on clusters found, treating them as “known” groups.</li>
</ul>
</section>
<section id="discriminant-analysis" class="level2">
<h2 class="anchored" data-anchor-id="discriminant-analysis">Discriminant analysis</h2>
<ul>
<li><p>So what makes the groups different?</p></li>
<li><p>Uses package <code>MASS</code> (loaded):</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>vital.lda <span class="ot">&lt;-</span> <span class="fu">lda</span>(vital.km6<span class="sc">$</span>cluster <span class="sc">~</span> birth <span class="sc">+</span> death <span class="sc">+</span> infant, </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> vital.s)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>vital.lda<span class="sc">$</span>svd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21.687195  8.851811  1.773006</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>vital.lda<span class="sc">$</span>scaling</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             LD1        LD2        LD3
birth  2.6879695  1.1224202 -1.9483853
death  0.6652712 -2.7213044 -0.6049358
infant 2.1111801  0.7650912  2.3542296</code></pre>
</div>
</div>
<ul>
<li><p>LD1 is some of everything (high=poor, low=rich).</p></li>
<li><p>LD2 mainly death rate, high or low.</p></li>
</ul>
</section>
<section id="a-data-frame-to-make-plot-from" class="level2">
<h2 class="anchored" data-anchor-id="a-data-frame-to-make-plot-from">A data frame to make plot from</h2>
<ul>
<li>Get predictions first:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>vital.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(vital.lda)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> vital.s<span class="sc">$</span>country,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> vital.km6<span class="sc">$</span>cluster, </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  vital.pred<span class="sc">$</span>x</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                country cluster         LD1
1               Albania       3 -2.74034473
2        Czechoslovakia       6 -5.01874312
3               Hungary       6 -4.97189595
4               Romania       6 -4.40612396
5                  USSR       6 -3.87181416
6         Ukrainian_SSR       6 -4.95502329
7               Bolivia       2  7.04719692
8                 Chile       3 -3.61284528
9               Ecuador       1  0.60813286
10             Paraguay       1 -0.09333631
11              Uruguay       6 -3.92003877
12               Mexico       4  1.17794263
13              Finland       6 -5.53992595
14               France       6 -5.48731510
15               Greece       6 -6.04517374
16                Italy       6 -6.23984314
17               Norway       6 -5.14396822
18                Spain       6 -6.20238403
19          Switzerland       6 -5.70503604
20              Austria       6 -5.48811665
21               Canada       6 -5.61852237
22          Afghanistan       5  9.15790453
23                 Iran       2  5.17009665
24               Israel       3 -4.09921633
25               Kuwait       3 -3.52238895
26                 Oman       1  2.12959716
27               Turkey       1  0.61384977
28           Bangladesh       2  6.18349326
29                China       3 -3.23659422
30                India       1  1.81800150
31                Korea       4 -1.46967404
32             Mongolia       1  1.67300272
33             Pakistan       1  2.24428372
34            Singapore       3 -5.25056428
35             Thailand       3 -3.05879372
36              Algeria       1  1.75779182
37             Botswana       2  4.48834877
38                Egypt       1  1.45515716
39                Gabon       2  5.07955834
40                Ghana       2  4.94529597
41                Libya       1  3.96906505
42              Morocco       1  2.33973207
43              Namibia       2  6.78839862
44         Sierra_Leone       5 10.11147508
45         South_Africa       1  1.22038392
46            Swaziland       2  6.62089564
47               Uganda       2  7.44759122
48                Zaire       2  5.01954548
49             Zimbabwe       1  2.90708292
50             Bulgaria       6 -5.02639603
51    Former_E._Germany       6 -5.36617200
52               Poland       6 -4.83913984
53           Yugoslavia       6 -4.87765104
54      Byelorussia_SSR       6 -4.89387951
55            Argentina       3 -3.38164344
56               Brazil       1 -0.17351090
57             Columbia       3 -1.72504134
58               Guyana       1 -0.64024371
59                 Peru       1  2.88979728
60            Venezuela       3 -2.71512137
61              Belgium       6 -5.61006438
62              Denmark       6 -5.36296636
63              Germany       6 -5.66618148
64              Ireland       6 -5.22803491
65          Netherlands       6 -5.69497185
66             Portugal       6 -5.54867384
67               Sweden       6 -5.14801099
68                 U.K.       6 -5.14080545
69                Japan       6 -6.74109078
70               U.S.A.       6 -4.98026088
71              Bahrain       3 -2.95751794
72                 Iraq       1  2.86550554
73               Jordan       1  0.78337204
74              Lebanon       1 -0.13242340
75         Saudi_Arabia       1  2.82947028
76 United_Arab_Emirates       3 -3.60965788
77             Cambodia       2  6.68714487
78            Hong_Kong       3 -6.56814921
79            Indonesia       1  0.59203984
80             Malaysia       3 -1.69768174
81                Nepal       2  5.98051592
82          Philippines       1 -0.11564367
83            Sri_Lanka       3 -3.86669807
84              Vietnam       1  0.73637772
85               Angola       5  8.67464018
86                Congo       2  4.71698904
87             Ethiopia       5  9.02400482
88               Gambia       5  9.16151584
89                Kenya       2  4.37728422
90               Malawi       5  9.25868839
91           Mozambique       5  8.17837256
92              Nigeria       2  6.80523311
93              Somalia       5  9.02055241
94                Sudan       2  6.19772237
95              Tunisia       1 -0.26827112
96             Tanzania       2  7.01894686
97               Zambia       2  5.90158841
           LD2          LD3
1   2.23114272  0.086392118
2  -2.54276395 -0.067491502
3  -3.62910309  0.149274227
4  -1.68114304  0.832426535
5  -0.99643221  0.134219177
6  -2.45593006  0.032543051
7  -1.82235340 -0.559232315
8   1.83697531 -0.440912763
9   2.45078735  0.333955737
10  2.72730980 -0.910115449
11 -0.75565723  0.086830641
12 -7.45661911 -2.185449656
13 -1.71396053 -0.111993227
14 -1.24432254  0.003489983
15 -1.35732249  0.717192252
16 -1.36850774  0.675127833
17 -1.94087447 -0.245927314
18 -0.77030865  0.612616941
19 -1.39900851  0.133327537
20  0.04445534  0.107554431
21  0.05655923  0.137152032
22 -1.57150002  3.855195867
23  1.59572127  0.728082136
24  1.32996325 -0.726569567
25  4.20168393 -0.538116615
26  2.88622987 -2.722021794
27  1.77493550  1.401386127
28 -0.58998184  0.808514931
29  1.37556784  0.521048584
30  1.07819827  1.747922987
31 -5.22549147 -1.651932383
32  1.97934176 -0.052585403
33  2.56907200  2.904858080
34  1.56461210 -0.048777986
35  0.81462641  0.027926012
36  2.32221009  0.405915880
37  1.35059836 -2.251690523
38  1.48375960 -1.484115076
39 -1.84934413  0.223023990
40  0.51518412 -0.679939548
41  2.51546738 -0.550299598
42  1.57697751  0.620167354
43  1.81616353  1.811177322
44 -4.13640327  0.708806858
45  1.07036311  0.584292394
46  1.53114576  0.486213522
47 -0.08614119 -1.461769491
48 -0.14593127 -1.354022712
49  1.53174980 -1.155638673
50 -2.68287368  0.194600531
51 -3.13019129 -0.146640390
52 -1.51169554  0.238889303
53 -0.76403413  0.653220196
54 -1.07548768  0.052116630
55  0.23391708  0.049204615
56  1.80173696  0.887331423
57  2.37367896  0.116914571
58  2.01175992  0.650267842
59  2.70398544  2.617485939
60  3.09958020 -0.531015134
61 -2.07122472  0.103010698
62 -2.80594142 -0.144208119
63 -2.48058100  0.085615217
64 -0.94271289 -0.168083173
65 -0.81402153  0.149795861
66 -1.34891130  0.526746892
67 -2.19511746 -0.439370072
68 -2.45732616 -0.218666957
69 -0.01816615  0.738650841
70 -0.19798546 -0.186143629
71  3.40403941 -0.956027685
72  3.12008079 -0.806112179
73  3.21739659 -1.371400507
74  1.34062918 -0.430471811
75  3.22903162 -0.605791417
76  3.10639879  0.361277059
77 -1.11737674  1.343455301
78  1.21156621  0.795955999
79  1.12304477  1.306331526
80  2.74828222 -1.241072895
81 -0.24581105  1.734265161
82  2.00054960 -0.669610455
83  1.46702228 -0.073210404
84  1.14664253  0.270008884
85 -2.62832040  0.398976877
86 -0.50507133 -1.989873503
87 -2.80509362  0.132536656
88 -3.21458937  0.521137723
89  1.48515306 -1.740964552
90 -5.46422766 -0.742329819
91 -1.74864060  1.141424236
92 -0.35943688 -0.827233974
93 -2.47121452 -0.274058230
94 -0.74977705 -0.138778600
95  2.17721533  0.042802627
96  0.75977710 -0.855439352
97  0.55264060 -2.233552693</code></pre>
</div>
</div>
</section>
<section id="whats-in-there-making-a-plot" class="level2">
<h2 class="anchored" data-anchor-id="whats-in-there-making-a-plot">What’s in there; making a plot</h2>
<ul>
<li><code>d</code> contains country names, cluster memberships and discriminant scores.</li>
<li>Plot <code>LD1</code> against <code>LD2</code>, colouring points by cluster and labelling by country:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d, <span class="fu">aes</span>(</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> LD1, <span class="at">y =</span> LD2, <span class="at">colour =</span> <span class="fu">factor</span>(cluster),</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> country</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">max.overlaps =</span> <span class="cn">Inf</span>) <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">colour =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-plot" class="level2">
<h2 class="anchored" data-anchor-id="the-plot">The plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It would be better to zoom in on parts of this plot.</p>
</section>
<section id="final-example-a-hockey-league" class="level2">
<h2 class="anchored" data-anchor-id="final-example-a-hockey-league">Final example: a hockey league</h2>
<ul>
<li><p>An Ontario hockey league has teams in 21 cities. How can we arrange those teams into 4 geographical divisions?</p></li>
<li><p>Distance data in spreadsheet.</p></li>
<li><p>Take out spaces in team names.</p></li>
<li><p>Save as “text/csv”.</p></li>
<li><p>Distances, so back to <code>hclust</code>.</p></li>
</ul>
</section>
<section id="a-map" class="level2">
<h2 class="anchored" data-anchor-id="a-map">A map</h2>
<p><img src="map1.png" class="img-fluid"></p>
</section>
<section id="attempt-1" class="level2">
<h2 class="anchored" data-anchor-id="attempt-1">Attempt 1</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"http://ritsokiguess.site/datafiles/ontario-road-distances.csv"</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>ontario <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(my_url)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>ontario.d <span class="ot">&lt;-</span> ontario <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.dist</span>()</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>ontario.hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(ontario.d, <span class="at">method =</span> <span class="st">"ward.D"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-with-4-clusters" class="level2">
<h2 class="anchored" data-anchor-id="plot-with-4-clusters">Plot, with 4 clusters</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ontario.hc)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rect.hclust</span>(ontario.hc, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comments-2" class="level2">
<h2 class="anchored" data-anchor-id="comments-2">Comments</h2>
<ul>
<li><p>Can’t have divisions of 1 team!</p></li>
<li><p>“Southern” divisions way too big!</p></li>
<li><p>Try splitting into more. I found 7 to be good:</p></li>
</ul>
</section>
<section id="seven-clusters" class="level2">
<h2 class="anchored" data-anchor-id="seven-clusters">Seven clusters</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ontario.hc)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rect.hclust</span>(ontario.hc, <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cluster_files/figure-html/bCluster-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="divisions-now" class="level2">
<h2 class="anchored" data-anchor-id="divisions-now">Divisions now</h2>
<ul>
<li><p>I want to put Huntsville and North Bay together with northern teams.</p></li>
<li><p>I’ll put the Eastern teams together. Gives:</p></li>
<li><p>North: Sault Ste Marie, Sudbury, Huntsville, North Bay</p></li>
<li><p>East: Brockville, Cornwall, Ottawa, Peterborough, Belleville, Kingston</p></li>
<li><p>West: Windsor, London, Sarnia</p></li>
<li><p>Central: Owen Sound, Barrie, Toronto, Niagara Falls, St Catharines, Brantford, Hamilton, Kitchener</p></li>
<li><p>Getting them same size beyond us!</p></li>
</ul>
</section>
<section id="another-map" class="level2">
<h2 class="anchored" data-anchor-id="another-map">Another map</h2>
<p><img src="map2.png" class="img-fluid"></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>