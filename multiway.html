<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Multiway Frequency Tables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="multiway_files/libs/clipboard/clipboard.min.js"></script>
<script src="multiway_files/libs/quarto-html/quarto.js"></script>
<script src="multiway_files/libs/quarto-html/popper.min.js"></script>
<script src="multiway_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="multiway_files/libs/quarto-html/anchor.min.js"></script>
<link href="multiway_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="multiway_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="multiway_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="multiway_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="multiway_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="multiway_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="multiway_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="multiway.html"><i class="bi bi-file-slides"></i>RevealJS</a></li><li><a href="multiway.pdf"><i class="bi bi-file-pdf"></i>Beamer</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multiway Frequency Tables</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="multi-way-frequency-analysis" class="level2">
<h2 class="anchored" data-anchor-id="multi-way-frequency-analysis">Multi-way frequency analysis</h2>
<ul>
<li>A study of gender and eyewear-wearing finds the following frequencies:</li>
</ul>
<pre><code>gender contacts glasses none
female 121      32      129
male   42       37      85</code></pre>
<ul>
<li><p>Is there association between eyewear and gender?</p></li>
<li><p>Normally answer this with chisquare test (based on observed and expected frequencies from null hypothesis of no association).</p></li>
<li><p>Two categorical variables and a frequency.</p></li>
<li><p>We assess in way that generalizes to more categorical variables.</p></li>
</ul>
</section>
<section id="the-data-file" class="level2">
<h2 class="anchored" data-anchor-id="the-data-file">The data file</h2>
<pre><code>gender contacts glasses none
female 121      32      129
male   42       37      85</code></pre>
<ul>
<li><p>This is <em>not tidy!</em></p></li>
<li><p>Two variables are gender and <em>eyewear</em>, and those numbers all frequencies.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/eyewear.txt"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>(eyewear <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["gender"],"name":[1],"type":["chr"],"align":["left"]},{"label":["contacts"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["glasses"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["none"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"female","2":"121","3":"32","4":"129"},{"1":"male","2":"42","3":"37","4":"85"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="tidying-the-data" class="level2">
<h2 class="anchored" data-anchor-id="tidying-the-data">Tidying the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>eyewear <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(contacts<span class="sc">:</span>none, <span class="at">names_to=</span><span class="st">"eyewear"</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span><span class="st">"frequency"</span>) <span class="ot">-&gt;</span> eyes</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>eyes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["gender"],"name":[1],"type":["chr"],"align":["left"]},{"label":["eyewear"],"name":[2],"type":["chr"],"align":["left"]},{"label":["frequency"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"female","2":"contacts","3":"121"},{"1":"female","2":"glasses","3":"32"},{"1":"female","2":"none","3":"129"},{"1":"male","2":"contacts","3":"42"},{"1":"male","2":"glasses","3":"37"},{"1":"male","2":"none","3":"85"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="making-tidy-data-back-into-a-table" class="level2">
<h2 class="anchored" data-anchor-id="making-tidy-data-back-into-a-table">Making tidy data back into a table</h2>
<ul>
<li>use <code>pivot_wider</code></li>
<li>which you can also use to reformat:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>eyes <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> gender, <span class="at">values_from =</span> frequency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["eyewear"],"name":[1],"type":["chr"],"align":["left"]},{"label":["female"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["male"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"contacts","2":"121","3":"42"},{"1":"glasses","2":"32","3":"37"},{"1":"none","2":"129","3":"85"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="modelling" class="level2">
<h2 class="anchored" data-anchor-id="modelling">Modelling</h2>
<ul>
<li>Predict frequency from other factors and combos.</li>
<li><code>glm</code> with <code>poisson</code> family.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>eyes<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(frequency <span class="sc">~</span> gender <span class="sc">*</span> eyewear,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> eyes,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"poisson"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Called <strong>log-linear model</strong>.</li>
</ul>
</section>
<section id="what-can-we-get-rid-of" class="level2">
<h2 class="anchored" data-anchor-id="what-can-we-get-rid-of">What can we get rid of?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(eyes<span class="fl">.1</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"7.549517e-15","3":"47.95815","4":"NA","5":"NA","_rn_":"<none>"},{"1":"2","2":"1.782863e+01","3":"61.78678","4":"17.82863","5":"0.0001344505","_rn_":"gender:eyewear"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>nothing!</p>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<ul>
<li><p><code>drop1</code> says what we can remove at this step. Significant = must stay.</p></li>
<li><p>Cannot remove anything.</p></li>
<li><p>Frequency depends on <code>gender-eye wear</code> <em>combination</em>, cannot be simplified further.</p></li>
<li><p>Gender and eyewear are <em>associated</em>.</p></li>
<li><p>For modelling, stop here.</p></li>
</ul>
</section>
<section id="making-a-graph" class="level2">
<h2 class="anchored" data-anchor-id="making-a-graph">Making a graph</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eyes, <span class="fu">aes</span>(<span class="at">x =</span> gender, <span class="at">y =</span> frequency, <span class="at">fill =</span> eyewear)) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conclusions-1" class="level2">
<h2 class="anchored" data-anchor-id="conclusions-1">Conclusions</h2>
<ul>
<li>Females are more likely to wear contacts than males are.</li>
<li>Females are <em>less</em> likely to wear glasses than males are.</li>
<li>The previous two comments are the reasons for the significant association.</li>
</ul>
</section>
<section id="code-comments-12" class="level2">
<h2 class="anchored" data-anchor-id="code-comments-12">Code comments 1/2</h2>
<ul>
<li>The code again:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eyes, <span class="fu">aes</span>(<span class="at">x =</span> gender, <span class="at">y =</span> frequency, <span class="at">fill =</span> eyewear)) <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Variation on two-variable bar chart that we saw in C32.</li>
<li>Comparing (most easily) <em>proportions</em>, so <code>fill</code> clearer than <code>dodge</code>.</li>
<li>Each row of dataframe represents many people (the number in <code>frequency</code>), so use <code>geom_col</code> rather than <code>geom_bar</code>.</li>
<li><code>geom_col</code> takes a <code>y</code> that should be the frequency.</li>
</ul>
</section>
<section id="code-comments-22" class="level2">
<h2 class="anchored" data-anchor-id="code-comments-22">Code comments 2/2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eyes, <span class="fu">aes</span>(<span class="at">x =</span> gender, <span class="at">y =</span> frequency, <span class="at">fill =</span> eyewear)) <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Often in this work, one variable in association is explanatory rather than response. Have that as <code>x</code> (here <code>gender</code>); <code>eyewear</code> is response and goes in <code>fill</code>.</li>
<li>Interpretation: out of each category of explanatory (“out of females”), what proportion in each response category and where do they differ?</li>
</ul>
</section>
<section id="no-association" class="level2">
<h2 class="anchored" data-anchor-id="no-association">No association</h2>
<ul>
<li>Suppose table had been as shown below:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/eyewear2.txt"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>eyewear2 <span class="ot">&lt;-</span> <span class="fu">read_table</span>(my_url)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>eyewear2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["gender"],"name":[1],"type":["chr"],"align":["left"]},{"label":["contacts"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["glasses"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["none"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"female","2":"150","3":"30","4":"120"},{"1":"male","2":"75","3":"16","4":"62"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>eyewear2 <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_longer</span>(contacts<span class="sc">:</span>none, <span class="at">names_to =</span> <span class="st">"eyewear"</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_to =</span> <span class="st">"frequency"</span>) <span class="ot">-&gt;</span> eyes2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comments" class="level2">
<h2 class="anchored" data-anchor-id="comments">Comments</h2>
<ul>
<li>Females and males wear contacts and glasses <em>in same proportions</em>
<ul>
<li>though more females and more contact-wearers.</li>
</ul></li>
<li>No <em>association</em> between gender and eyewear.</li>
</ul>
</section>
<section id="analysis-for-revised-data" class="level2">
<h2 class="anchored" data-anchor-id="analysis-for-revised-data">Analysis for revised data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>eyes<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(frequency <span class="sc">~</span> gender <span class="sc">*</span> eyewear,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> eyes2,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"poisson"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(eyes<span class="fl">.2</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"2.176037e-14","3":"47.46718","4":"NA","5":"NA","_rn_":"<none>"},{"1":"2","2":"4.732267e-02","3":"43.51450","4":"0.04732267","5":"0.9766164","_rn_":"gender:eyewear"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>No longer any association. Take out interaction.</p>
</section>
<section id="no-interaction" class="level2">
<h2 class="anchored" data-anchor-id="no-interaction">No interaction</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>eyes<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(eyes<span class="fl">.2</span>, . <span class="sc">~</span> . <span class="sc">-</span> gender<span class="sc">:</span>eyewear)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(eyes<span class="fl">.3</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"0.04732267","3":"43.51450","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"48.62389131","3":"90.09107","4":"48.57657","5":"3.176418e-12","_rn_":"gender"},{"1":"2","2":"138.13041408","3":"177.59759","4":"138.08309","5":"1.036663e-30","_rn_":"eyewear"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul>
<li><p>More females (gender effect) over all eyewear</p></li>
<li><p>fewer glasses-wearers (eyewear effect) over both genders</p></li>
<li><p>no association (no interaction).</p></li>
</ul>
</section>
<section id="graph-shows-no-association" class="level2">
<h2 class="anchored" data-anchor-id="graph-shows-no-association">Graph shows no association</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eyes2, <span class="fu">aes</span>(<span class="at">x =</span> gender, <span class="at">y =</span> frequency, <span class="at">fill =</span> eyewear)) <span class="sc">+</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="chest-pain-being-overweight-and-being-a-smoker" class="level2">
<h2 class="anchored" data-anchor-id="chest-pain-being-overweight-and-being-a-smoker">Chest pain, being overweight and being a smoker</h2>
<ul>
<li><p>In a hospital emergency department, 176 subjects who attended for acute chest pain took part in a study.</p></li>
<li><p>Each subject had a normal or abnormal electrocardiogram reading (ECG), were overweight (as judged by BMI) or not, and were a smoker or not.</p></li>
<li><p>How are these three variables related, or not?</p></li>
</ul>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>In modelling-friendly format:</p>
<pre><code>
ecg bmi smoke count
abnormal overweight yes 47
abnormal overweight no 10
abnormal normalweight yes 8 
abnormal normalweight no 6
normal overweight yes 25 
normal overweight no 15 
normal normalweight yes 35
normal normalweight no 30</code></pre>
</section>
<section id="first-step" class="level2">
<h2 class="anchored" data-anchor-id="first-step">First step</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/ecg.txt"</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>chest <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">" "</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>chest<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(count <span class="sc">~</span> ecg <span class="sc">*</span> bmi <span class="sc">*</span> smoke,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> chest,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"poisson"</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(chest<span class="fl">.1</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"-1.475170e-28","3":"53.70730","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"1.388544e+00","3":"53.09584","4":"1.388544","5":"0.2386511","_rn_":"ecg:bmi:smoke"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>That 3-way interaction comes out.</p>
</section>
<section id="removing-the-3-way-interaction" class="level2">
<h2 class="anchored" data-anchor-id="removing-the-3-way-interaction">Removing the 3-way interaction</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>chest<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(chest<span class="fl">.1</span>, . <span class="sc">~</span> . <span class="sc">-</span> ecg<span class="sc">:</span>bmi<span class="sc">:</span>smoke)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(chest<span class="fl">.2</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"1.388544","3":"53.09584","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"29.019513","3":"78.72681","4":"27.630969","5":"1.468094e-07","_rn_":"ecg:bmi"},{"1":"1","2":"4.893513","3":"54.60081","4":"3.504968","5":"6.118501e-02","_rn_":"ecg:smoke"},{"1":"1","2":"4.468863","3":"54.17616","4":"3.080319","5":"7.924499e-02","_rn_":"bmi:smoke"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>At <span class="math inline">\(\alpha=0.05\)</span>, <code>bmi:smoke</code> comes out.</p>
</section>
<section id="removing-bmismoke" class="level2">
<h2 class="anchored" data-anchor-id="removing-bmismoke">Removing <code>bmi:smoke</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>chest<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(chest<span class="fl">.2</span>, . <span class="sc">~</span> . <span class="sc">-</span> bmi<span class="sc">:</span>smoke)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(chest<span class="fl">.3</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"4.468863","3":"54.17616","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"36.562474","3":"84.26977","4":"32.09361","5":"1.469197e-08","_rn_":"ecg:bmi"},{"1":"1","2":"12.436473","3":"60.14377","4":"7.96761","5":"4.762177e-03","_rn_":"ecg:smoke"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<ul>
<li><p><code>ecg:smoke</code> has become significant. So we have to stop.</p></li>
<li><p><code>ecg</code> is associated with both <code>bmi</code> and <code>smoke</code>, but separately (it doesn’t depend on the combination of <code>bmi</code> and <code>smoke</code>).</p></li>
</ul>
</section>
<section id="understanding-the-final-model" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-final-model">Understanding the final model</h2>
<ul>
<li>For each of the significant associations, make a bar chart (here, two-variable because two-way interactions)</li>
<li>Here, <code>ecg</code> is response (patients came into the study being smokers or overweight) so use as <code>fill</code> in both graphs.</li>
<li><code>y</code> is the frequency column.</li>
</ul>
</section>
<section id="ecgbmi" class="level2">
<h2 class="anchored" data-anchor-id="ecgbmi"><code>ecg:bmi</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chest, <span class="fu">aes</span>(<span class="at">x =</span> bmi, <span class="at">y =</span> count, <span class="at">fill =</span> ecg)) <span class="sc">+</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comment" class="level2">
<h2 class="anchored" data-anchor-id="comment">Comment</h2>
<ul>
<li>Most of the normal weight people had a normal ECG as well, but for the overweight people, a small majority had an abnormal ECG.</li>
</ul>
</section>
<section id="ecgsmoke" class="level2">
<h2 class="anchored" data-anchor-id="ecgsmoke"><code>ecg:smoke</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chest, <span class="fu">aes</span>(<span class="at">x =</span> smoke, <span class="at">y =</span> count, <span class="at">fill =</span> ecg)) <span class="sc">+</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comments-1" class="level2">
<h2 class="anchored" data-anchor-id="comments-1">Comments</h2>
<ul>
<li><p>Most nonsmokers have a normal ECG, but smokers are about 50–50 normal and abnormal ECG.</p></li>
<li><p>Don’t look at <code>smoke:bmi</code> since not significant.</p></li>
</ul>
</section>
<section id="simpsons-paradox-the-airlines-example" class="level2">
<h2 class="anchored" data-anchor-id="simpsons-paradox-the-airlines-example">Simpson’s paradox: the airlines example</h2>
<pre><code>               Alaska Airlines       America West
Airport       On time    Delayed   On time    Delayed
Los Angeles      497        62        694       117
Phoenix          221        12       4840       415
San Diego        212        20        383        65
San Francisco    503       102        320       129
Seattle         1841       305        201        61

Total           3274       501       6438       787</code></pre>
<p>Use <code>status</code> as variable name for “on time/delayed”.</p>
<ul>
<li><p>Alaska: 13.3% flights delayed (<span class="math inline">\(501/(3274+501)\)</span>).</p></li>
<li><p>America West: 10.9% (<span class="math inline">\(787/(6438+787)\)</span>).</p></li>
<li><p>America West more punctual, right?</p></li>
</ul>
</section>
<section id="arranging-the-data" class="level2">
<h2 class="anchored" data-anchor-id="arranging-the-data">Arranging the data</h2>
<ul>
<li>Can only have single thing in columns, so we have to construct column names like this: </li>
</ul>
<pre><code>
airport    aa_ontime aa_delayed aw_ontime aw_delayed
LosAngeles   497          62       694        117
Phoenix      221          12      4840        415
SanDiego     212          20       383         65
SanFrancisco 503         102       320        129
Seattle     1841         305       201         61</code></pre>
<ul>
<li>Read in:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/airlines.txt"</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>airlines <span class="ot">&lt;-</span> <span class="fu">read_table</span>(my_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidying" class="level2">
<h2 class="anchored" data-anchor-id="tidying">Tidying</h2>
<ul>
<li>Some tidying gets us the right layout, with frequencies all in one column and the airline and delayed/on time status separated out. This uses one of the fancy versions of <code>pivot_longer</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>airlines <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_longer</span>(<span class="sc">-</span>airport, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"airline"</span>, <span class="st">"status"</span>), </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">names_sep =</span> <span class="st">"_"</span>, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_to =</span> <span class="st">"freq"</span> ) <span class="ot">-&gt;</span> punctual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-data-frame-punctual" class="level2">
<h2 class="anchored" data-anchor-id="the-data-frame-punctual">The data frame <code>punctual</code></h2>
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["airport"],"name":[1],"type":["chr"],"align":["left"]},{"label":["airline"],"name":[2],"type":["chr"],"align":["left"]},{"label":["status"],"name":[3],"type":["chr"],"align":["left"]},{"label":["freq"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"LosAngeles","2":"aa","3":"ontime","4":"497"},{"1":"LosAngeles","2":"aa","3":"delayed","4":"62"},{"1":"LosAngeles","2":"aw","3":"ontime","4":"694"},{"1":"LosAngeles","2":"aw","3":"delayed","4":"117"},{"1":"Phoenix","2":"aa","3":"ontime","4":"221"},{"1":"Phoenix","2":"aa","3":"delayed","4":"12"},{"1":"Phoenix","2":"aw","3":"ontime","4":"4840"},{"1":"Phoenix","2":"aw","3":"delayed","4":"415"},{"1":"SanDiego","2":"aa","3":"ontime","4":"212"},{"1":"SanDiego","2":"aa","3":"delayed","4":"20"},{"1":"SanDiego","2":"aw","3":"ontime","4":"383"},{"1":"SanDiego","2":"aw","3":"delayed","4":"65"},{"1":"SanFrancisco","2":"aa","3":"ontime","4":"503"},{"1":"SanFrancisco","2":"aa","3":"delayed","4":"102"},{"1":"SanFrancisco","2":"aw","3":"ontime","4":"320"},{"1":"SanFrancisco","2":"aw","3":"delayed","4":"129"},{"1":"Seattle","2":"aa","3":"ontime","4":"1841"},{"1":"Seattle","2":"aa","3":"delayed","4":"305"},{"1":"Seattle","2":"aw","3":"ontime","4":"201"},{"1":"Seattle","2":"aw","3":"delayed","4":"61"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="proportions-delayed-by-airline" class="level2">
<h2 class="anchored" data-anchor-id="proportions-delayed-by-airline">Proportions delayed by airline</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(punctual, <span class="fu">aes</span>(<span class="at">x =</span> airline, <span class="at">y =</span> freq, <span class="at">fill =</span> status)) <span class="sc">+</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comment-1" class="level2">
<h2 class="anchored" data-anchor-id="comment-1">Comment</h2>
<ul>
<li>Most flights are on time, but Alaska Airlines is late a little more often.</li>
</ul>
</section>
<section id="proportion-delayed-by-airport-for-each-airline" class="level2">
<h2 class="anchored" data-anchor-id="proportion-delayed-by-airport-for-each-airline">Proportion delayed by airport, for each airline</h2>
<p>We now have <em>three</em> categorical variables, so use one of the explanatories (for me, airport) as facets:</p>
</section>
<section id="the-graphs" class="level2">
<h2 class="anchored" data-anchor-id="the-graphs">The graph(s)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(punctual, <span class="fu">aes</span>(<span class="at">x =</span> airline, <span class="at">y =</span> freq, <span class="at">fill =</span> status)) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> airport)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="simpsons-paradox" class="level2">
<h2 class="anchored" data-anchor-id="simpsons-paradox">Simpson’s Paradox</h2>
<ul>
<li><p>America West more punctual overall,</p></li>
<li><p>but worse at <em>every single</em> airport!</p></li>
<li><p>How is that possible?</p></li>
<li><p>Log-linear analysis sheds some light.</p></li>
</ul>
</section>
<section id="model-1-and-output" class="level2">
<h2 class="anchored" data-anchor-id="model-1-and-output">Model 1 and output</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>punctual<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(freq <span class="sc">~</span> airport <span class="sc">*</span> airline <span class="sc">*</span> status,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> punctual, <span class="at">family =</span> <span class="st">"poisson"</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(punctual<span class="fl">.1</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"4.662937e-13","3":"183.4348","4":"NA","5":"NA","_rn_":"<none>"},{"1":"4","2":"3.216569e+00","3":"178.6513","4":"3.216569","5":"0.5222589","_rn_":"airport:airline:status"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="remove-3-way-interaction" class="level2">
<h2 class="anchored" data-anchor-id="remove-3-way-interaction">Remove 3-way interaction</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>punctual<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(punctual<span class="fl">.1</span>, <span class="sc">~</span> . <span class="sc">-</span> airport<span class="sc">:</span>airline<span class="sc">:</span>status)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(punctual<span class="fl">.2</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"3.216569","3":"178.6513","4":"NA","5":"NA","_rn_":"<none>"},{"1":"4","2":"6432.454138","3":"6599.8889","4":"6429.23757","5":"0.000000e+00","_rn_":"airport:airline"},{"1":"4","2":"240.107798","3":"407.5426","4":"236.89123","5":"4.334046e-50","_rn_":"airport:status"},{"1":"1","2":"45.465141","3":"218.8999","4":"42.24857","5":"8.037869e-11","_rn_":"airline:status"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Stop here, and draw graphs to understand significant results.</p>
</section>
<section id="airlinestatus" class="level2">
<h2 class="anchored" data-anchor-id="airlinestatus"><code>airline:status</code>:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(punctual, <span class="fu">aes</span>(<span class="at">x =</span> airline, <span class="at">y =</span> freq, <span class="at">fill =</span> status)) <span class="sc">+</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comments-2" class="level2">
<h2 class="anchored" data-anchor-id="comments-2">Comments</h2>
<ul>
<li><p>We did this one before.</p></li>
<li><p>Slightly more of Alaska Airlines’ flights delayed overall.</p></li>
</ul>
</section>
<section id="airportstatus" class="level2">
<h2 class="anchored" data-anchor-id="airportstatus"><code>airport:status</code>:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(punctual, <span class="fu">aes</span>(<span class="at">x =</span> airport, <span class="at">y =</span> freq, <span class="at">fill =</span> status)) <span class="sc">+</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comments-3" class="level2">
<h2 class="anchored" data-anchor-id="comments-3">Comments</h2>
<ul>
<li><p>Flights into San Francisco (and maybe Seattle) are often late, and flights into Phoenix are usually on time.</p></li>
<li><p>Considerable variation among airports.</p></li>
</ul>
</section>
<section id="airportairline" class="level2">
<h2 class="anchored" data-anchor-id="airportairline"><code>airport:airline</code>:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(punctual, <span class="fu">aes</span>(<span class="at">x =</span> airport, <span class="at">y =</span> freq, <span class="at">fill =</span> airline)) <span class="sc">+</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comments-4" class="level2">
<h2 class="anchored" data-anchor-id="comments-4">Comments</h2>
<ul>
<li><p>What fraction of each airline’s flights are to each airport.</p></li>
<li><p>Most of Alaska Airlines’ flights to Seattle and San Francisco.</p></li>
<li><p>Most of America West’s flights to Phoenix.</p></li>
</ul>
</section>
<section id="the-resolution" class="level2">
<h2 class="anchored" data-anchor-id="the-resolution">The resolution</h2>
<ul>
<li><p>Most of America West’s flights to Phoenix, where it is easy to be on time.</p></li>
<li><p>Most of Alaska Airlines’ flights to San Francisco and Seattle, where it is difficult to be on time.</p></li>
<li><p>Overall comparison looks bad for Alaska because of this.</p></li>
<li><p>But, <em>comparing like with like</em>, if you compare each airline’s performance <em>to the same airport</em>, Alaska does better.</p></li>
<li><p>Aggregating over the very different airports was a (big) mistake: that was the cause of the Simpson’s paradox.</p></li>
<li><p>Alaska Airlines is <em>more</em> punctual when you do the proper comparison.</p></li>
</ul>
</section>
<section id="ovarian-cancer-a-four-way-table" class="level2">
<h2 class="anchored" data-anchor-id="ovarian-cancer-a-four-way-table">Ovarian cancer: a four-way table</h2>
<ul>
<li><p>Retrospective study of ovarian cancer done in 1973.</p></li>
<li><p>Information about 299 women operated on for ovarian cancer 10 years previously.</p></li>
<li><p>Recorded:</p>
<ul>
<li><p>stage of cancer (early or advanced)</p></li>
<li><p>type of operation (radical or limited)</p></li>
<li><p>X-ray treatment received (yes or no)</p></li>
<li><p>10-year survival (yes or no)</p></li>
</ul></li>
<li><p>Survival looks like response (suggests logistic regression).</p></li>
<li><p>Log-linear model finds any associations at all.</p></li>
</ul>
</section>
<section id="the-data-1" class="level2">
<h2 class="anchored" data-anchor-id="the-data-1">The data</h2>
<p>after tidying:</p>
<pre><code>
stage operation xray survival freq
early radical no no 10
early radical no yes 41
early radical yes no 17
early radical yes yes 64
early limited no no 1
early limited no yes 13
early limited yes no 3
early limited yes yes 9
advanced radical no no 38
advanced radical no yes 6
advanced radical yes no 64
advanced radical yes yes 11
advanced limited no no 3
advanced limited no yes 1
advanced limited yes no 13
advanced limited yes yes 5
</code></pre>
</section>
<section id="reading-in-data" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-data">Reading in data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/cancer.txt"</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>cancer <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">" "</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>cancer <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["stage"],"name":[1],"type":["chr"],"align":["left"]},{"label":["operation"],"name":[2],"type":["chr"],"align":["left"]},{"label":["xray"],"name":[3],"type":["chr"],"align":["left"]},{"label":["survival"],"name":[4],"type":["chr"],"align":["left"]},{"label":["freq"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"early","2":"radical","3":"no","4":"no","5":"10"},{"1":"early","2":"radical","3":"no","4":"yes","5":"41"},{"1":"early","2":"radical","3":"yes","4":"no","5":"17"},{"1":"early","2":"radical","3":"yes","4":"yes","5":"64"},{"1":"early","2":"limited","3":"no","4":"no","5":"1"},{"1":"early","2":"limited","3":"no","4":"yes","5":"13"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="model-1" class="level2">
<h2 class="anchored" data-anchor-id="model-1">Model 1</h2>
<p>hopefully looking familiar by now:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>cancer<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(freq <span class="sc">~</span> stage <span class="sc">*</span> operation <span class="sc">*</span> xray <span class="sc">*</span> survival,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> cancer, <span class="at">family =</span> <span class="st">"poisson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="output-1" class="level2">
<h2 class="anchored" data-anchor-id="output-1">Output 1</h2>
<p>See what we can remove:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(cancer<span class="fl">.1</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"-3.774763e-15","3":"98.12961","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"6.026558e-01","3":"96.73227","4":"0.6026558","5":"0.4375665","_rn_":"stage:operation:xray:survival"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Non-significant interaction can come out.</p>
</section>
<section id="model-2" class="level2">
<h2 class="anchored" data-anchor-id="model-2">Model 2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cancer<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(cancer<span class="fl">.1</span>, . <span class="sc">~</span> . <span class="sc">-</span> stage<span class="sc">:</span>operation<span class="sc">:</span>xray<span class="sc">:</span>survival)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(cancer<span class="fl">.2</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"0.6026558","3":"96.73227","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"2.3575888","3":"96.48720","4":"1.7549331","5":"0.1852578","_rn_":"stage:operation:xray"},{"1":"1","2":"1.1773024","3":"95.30692","4":"0.5746466","5":"0.4484184","_rn_":"stage:operation:survival"},{"1":"1","2":"0.9557671","3":"95.08538","4":"0.3531113","5":"0.5523571","_rn_":"stage:xray:survival"},{"1":"1","2":"1.2337838","3":"95.36340","4":"0.6311281","5":"0.4269418","_rn_":"operation:xray:survival"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Least significant term is <code>stage:xray:survival</code>: remove.</p>
</section>
<section id="take-out-stagexraysurvival" class="level2">
<h2 class="anchored" data-anchor-id="take-out-stagexraysurvival">Take out <code>stage:xray:survival</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>cancer<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(cancer<span class="fl">.2</span>, . <span class="sc">~</span> . <span class="sc">-</span> stage<span class="sc">:</span>xray<span class="sc">:</span>survival)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(cancer<span class="fl">.3</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"0.9557671","3":"95.08538","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"3.0866591","3":"95.21627","4":"2.1308920","5":"0.1443567","_rn_":"stage:operation:xray"},{"1":"1","2":"1.5660529","3":"93.69567","4":"0.6102858","5":"0.4346802","_rn_":"stage:operation:survival"},{"1":"1","2":"1.5512410","3":"93.68085","4":"0.5954739","5":"0.4403102","_rn_":"operation:xray:survival"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>operation:xray:survival</code> comes out next.</p>
</section>
<section id="remove-operationxraysurvival" class="level2">
<h2 class="anchored" data-anchor-id="remove-operationxraysurvival">Remove <code>operation:xray:survival</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cancer<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(cancer<span class="fl">.3</span>, . <span class="sc">~</span> . <span class="sc">-</span> operation<span class="sc">:</span>xray<span class="sc">:</span>survival)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(cancer<span class="fl">.4</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"1.551241","3":"93.68085","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"1.697682","3":"91.82729","4":"0.1464406","5":"0.70196030","_rn_":"xray:survival"},{"1":"1","2":"6.841961","3":"96.97157","4":"5.2907197","5":"0.02143936","_rn_":"stage:operation:xray"},{"1":"1","2":"1.931103","3":"92.06072","4":"0.3798619","5":"0.53767715","_rn_":"stage:operation:survival"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="comments-5" class="level2">
<h2 class="anchored" data-anchor-id="comments-5">Comments</h2>
<ul>
<li><p><code>stage:operation:xray</code> has now become significant, so won’t remove that.</p></li>
<li><p>Shows value of removing terms one at a time.</p></li>
<li><p>There are no higher-order interactions containing both <code>xray</code> and <code>survival</code>, so now we get to test (and remove) <code>xray:survival</code>.</p></li>
</ul>
</section>
<section id="remove-xraysurvival" class="level2">
<h2 class="anchored" data-anchor-id="remove-xraysurvival">Remove <code>xray:survival</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>cancer<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(cancer<span class="fl">.4</span>, . <span class="sc">~</span> . <span class="sc">-</span> xray<span class="sc">:</span>survival)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(cancer<span class="fl">.5</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"1.697682","3":"91.82729","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"6.927690","3":"95.05730","4":"5.2300086","5":"0.02220042","_rn_":"stage:operation:xray"},{"1":"1","2":"2.024220","3":"90.15383","4":"0.3265384","5":"0.56770454","_rn_":"stage:operation:survival"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="remove-stageoperationsurvival" class="level2">
<h2 class="anchored" data-anchor-id="remove-stageoperationsurvival">Remove <code>stage:operation:survival</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cancer<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(cancer<span class="fl">.5</span>, . <span class="sc">~</span> . <span class="sc">-</span> stage<span class="sc">:</span>operation<span class="sc">:</span>survival)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(cancer<span class="fl">.6</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"2.024220","3":"90.15383","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"135.197636","3":"221.32725","4":"133.173416","5":"8.284940e-31","_rn_":"stage:survival"},{"1":"1","2":"4.115730","3":"90.24534","4":"2.091510","5":"1.481196e-01","_rn_":"operation:survival"},{"1":"1","2":"7.254229","3":"93.38384","4":"5.230009","5":"2.220042e-02","_rn_":"stage:operation:xray"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="last-step" class="level2">
<h2 class="anchored" data-anchor-id="last-step">Last step?</h2>
<p>Remove <code>operation:survival</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>cancer<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(cancer<span class="fl">.6</span>, . <span class="sc">~</span> . <span class="sc">-</span> operation<span class="sc">:</span>survival)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(cancer<span class="fl">.7</span>, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LRT"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"4.115730","3":"90.24534","4":"NA","5":"NA","_rn_":"<none>"},{"1":"1","2":"136.729112","3":"220.85872","4":"132.613382","5":"1.098503e-30","_rn_":"stage:survival"},{"1":"1","2":"9.345738","3":"93.47535","4":"5.230009","5":"2.220042e-02","_rn_":"stage:operation:xray"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Finally done!</p>
</section>
<section id="conclusions-2" class="level2">
<h2 class="anchored" data-anchor-id="conclusions-2">Conclusions</h2>
<ul>
<li><p>What matters is things associated with <code>survival</code> (<code>survival</code> is “response”).</p></li>
<li><p>Only significant such term is <code>stage:survival</code>.</p></li>
</ul>
</section>
<section id="the-graph" class="level2">
<h2 class="anchored" data-anchor-id="the-graph">The graph</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cancer, <span class="fu">aes</span>(<span class="at">x =</span> stage, <span class="at">y =</span> freq, <span class="at">fill =</span> survival)) <span class="sc">+</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comments-6" class="level2">
<h2 class="anchored" data-anchor-id="comments-6">Comments</h2>
<ul>
<li><p>Most people in early stage of cancer survived, and most people in advanced stage did not survive.</p></li>
<li><p>This true <em>regardless</em> of type of operation or whether or not X-ray treatment was received. These things have no impact on survival.</p></li>
</ul>
</section>
<section id="what-about-that-other-interaction" class="level2">
<h2 class="anchored" data-anchor-id="what-about-that-other-interaction">What about that other interaction?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cancer, <span class="fu">aes</span>(<span class="at">x =</span> stage, <span class="at">y =</span> freq, <span class="at">fill =</span> xray)) <span class="sc">+</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> operation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiway_files/figure-revealjs/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comments-7" class="level2">
<h2 class="anchored" data-anchor-id="comments-7">Comments</h2>
<ul>
<li><p>The association is between <code>stage</code> and <code>xray</code> <em>only for those who had the limited operation</em>.</p></li>
<li><p>For those who had the radical operation, there was no association between <code>stage</code> and <code>xray</code>.</p></li>
<li><p>This is of less interest than associations with <code>survival</code>.</p></li>
</ul>
</section>
<section id="general-procedure" class="level2">
<h2 class="anchored" data-anchor-id="general-procedure">General procedure</h2>
<ul>
<li><p>Start with “complete model” including all possible interactions.</p></li>
<li><p><code>drop1</code> gives highest-order interaction(s) remaining, remove least non-significant.</p></li>
<li><p>Repeat as necessary until everything significant.</p></li>
<li><p>Look at graphs of significant interactions.</p></li>
<li><p>Main effects not usually very interesting.</p></li>
<li><p>Interactions with “response” usually of most interest: show association with response.</p></li>
</ul>
</section>

</main>
<!-- /main column -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>